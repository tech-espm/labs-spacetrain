'use strict';var __awaiter=this&&this.__awaiter||function(a,c,b,d){function e(g){return g instanceof b?g:new b(function(f){f(g)})}return new (b||(b=Promise))(function(g,f){function h(l){try{k(d.next(l))}catch(n){f(n)}}function m(l){try{k(d["throw"](l))}catch(n){f(n)}}function k(l){l.done?g(l.value):e(l.value).then(h,m)}k((d=d.apply(a,c||[])).next())})},__generator=this&&this.__generator||function(a,c){function b(k){return function(l){return d([k,l])}}function d(k){if(g)throw new TypeError("Generator is already executing.");
for(;e;)try{if(g=1,f&&(h=k[0]&2?f["return"]:k[0]?f["throw"]||((h=f["return"])&&h.call(f),0):f.next)&&!(h=h.call(f,k[1])).done)return h;if(f=0,h)k=[k[0]&2,h.value];switch(k[0]){case 0:case 1:h=k;break;case 4:return e.label++,{value:k[1],done:!1};case 5:e.label++;f=k[1];k=[0];continue;case 7:k=e.ops.pop();e.trys.pop();continue;default:if(!(h=e.trys,h=0<h.length&&h[h.length-1])&&(6===k[0]||2===k[0])){e=0;continue}if(3===k[0]&&(!h||k[1]>h[0]&&k[1]<h[3]))e.label=k[1];else if(6===k[0]&&e.label<h[1])e.label=
h[1],h=k;else if(h&&e.label<h[2])e.label=h[2],e.ops.push(k);else{h[2]&&e.ops.pop();e.trys.pop();continue}}k=c.call(a,e)}catch(l){k=[6,l],f=0}finally{g=h=0}if(k[0]&5)throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}var e={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},g,f,h,m;return m={next:b(0),"throw":b(1),"return":b(2)},"function"===typeof Symbol&&(m[Symbol.iterator]=function(){return this}),m},__extends=this&&this.__extends||function(){var a=function(c,b){a=Object.setPrototypeOf||
{__proto__:[]}instanceof Array&&function(d,e){d.__proto__=e}||function(d,e){for(var g in e)Object.prototype.hasOwnProperty.call(e,g)&&(d[g]=e[g])};return a(c,b)};return function(c,b){function d(){this.constructor=c}if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");a(c,b);c.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)}}(),Strings=function(){function a(){}a.init=function(){var c=navigator.userLanguage||navigator.language;
c&&0===c.toLowerCase().indexOf("pt")&&(document.documentElement.setAttribute("lang","pt-br"),a.LandscapeWarning="O jogo funciona melhor no modo paisagem :)",a.Cancel="Cancelar",a.Clear="Limpar",a.Close="Fechar",a.Exit="Sair",a.Play="Jogar",a.Edit="Editar",a.Delete="Excluir",a.NextRound="Pr\u00f3xima Rodada",a.Finish="Terminar!",a.of="de",a.Round="Rodada ",a.point="ponto",a.points="pontos",a.Install="Instalar!",a.About="Sobre",a.PlayMusic="Tocar m\u00fasica",a.StopMusic="Parar m\u00fasica",a.Fullscreen=
"Tela Cheia",a.START="INICIAR",a.RULES="REGRAS",a.CREDITS="CR\u00c9DITOS",a.Victory="Sua pontua\u00e7\u00e3o final total foi {totalPoints}<br/>\n\t\t\t<br/>\n\t\t\t{regularPoints} pontos de aliens embarcados<br/>\n\t\t\t+<br/>\n\t\t\t{extraPoints} de b\u00f4nus por ",a.VictorySpeciesSingular=" \u00fanica esp\u00e9cie",a.VictorySpeciesPlural=" esp\u00e9cies diferentes",a.GameOverReposition="N\u00e3o \u00e9 permitido reposicionar os alien\u00edgenas!",a.GameOverFirstAvailable="Um novo alien\u00edgena deve sempre ser embarcado na primeira posi\u00e7\u00e3o dispon\u00edvel!",
a.GameOverReplace="N\u00e3o \u00e9 permitido substituir um alien\u00edgina j\u00e1 embarcado!",a.CreditsHTML='<h1 class="blue">GAME DESIGN</h2>\n\t\t\t<p>Vince Vader</p>\n\t\t\t<h1 class="green">PROGRAMA\u00c7\u00c3O</h2>\n\t\t\t<p>Carlos Rafael das Neves</p>\n\t\t\t<h1 class="orange">COORDENA\u00c7\u00c3O DE CRIA\u00c7\u00c3O</h2>\n\t\t\t<p>Eduardo Manente</p>\n\t\t\t<h1 class="red">COORDENA\u00c7\u00c3O DE PLANEJAMENTO</h2>\n\t\t\t<p>Eric de Carvalho</p>\n\t\t\t<h1 class="pink">LAYOUT E TRILHA SONORA</h2>\n\t\t\t<p>Camila Galastri Guedes</p>\n\t\t\t<p>Jo\u00e3o Pedro Rabelo</p>\n\t\t\t<p>Marcella Lizaso de Siqueira</p>\n\t\t\t<div class="insta">\n\t\t\t<h1>SIGA NO INSTA</h1>\n\t\t\t<p><a target="_blank" href="https://www.instagram.com/gamelab_espm/">@gamelab_espm</a></p>\n\t\t\t<p><a target="_blank" href="https://www.instagram.com/techespm/">@techespm</a></p>\n\t\t\t<p><a target="_blank" href="https://www.instagram.com/arenas_espm/">@arenas_espm</a></p>\n\t\t\t</div>',
a.DecimalSeparator=",",a.OppositeDecimalSeparator=".",a.Success="Sucesso!",a.Pause="Pausa",a.Restart="Reiniciar",a.Time="Tempo",a.Name="Nome")};a.LandscapeWarning="The game works better in landscape mode :)";a.OK="OK";a.Cancel="Cancel";a.Clear="Clear";a.Close="Close";a.Exit="Exit";a.Play="Play";a.Menu="Menu";a.Edit="Edit";a.Delete="Delete";a.NextRound="Next Round";a.Finish="Finish!";a.of="of";a.Round="Round ";a.Total="Total: ";a.point="point";a.points="points";a.Install="Install!";a.Oops="Oops\u2026";
a.Download="Download";a.About="About";a.PlayMusic="Play music";a.StopMusic="Stop music";a.Fullscreen="Fullscreen";a.START="START";a.RULES="RULES";a.CREDITS="CREDITS";a.Victory="Your final score was {totalPoints}<br/>\n\t<br/>\n\t{regularPoints} points for boarded aliens<br/>\n\t+<br/>\n\t{extraPoints} bonus points for ";a.VictorySpeciesSingular=" single species";a.VictorySpeciesPlural=" different species";a.GameOverReposition="Repositioning aliens is not allowed!";a.GameOverFirstAvailable="New aliens must always be boarded in the first available position!";
a.GameOverReplace="Replacing an already boarded alien is not allowed!";a.CreditsHTML='<h1 class="blue">GAME DESIGN</h2>\n\t<p>Vince Vader</p>\n\t<h1 class="green">PROGRAMMING</h2>\n\t<p>Carlos Rafael das Neves</p>\n\t<h1 class="orange">CREATIVE COORDINATION</h2>\n\t<p>Eduardo Manente</p>\n\t<h1 class="red">PLANNING COORDINATION</h2>\n\t<p>Eric de Carvalho</p>\n\t<h1 class="pink">LAYOUT AND SOUNDTRACK</h2>\n\t<p>Camila Galastri Guedes</p>\n\t<p>Jo\u00e3o Pedro Rabelo</p>\n\t<p>Marcella Lizaso de Siqueira</p>\n\t<div class="insta">\n\t<h1>INSTAGRAM</h1>\n\t<p><a target="_blank" href="https://www.instagram.com/gamelab_espm/">@gamelab_espm</a></p>\n\t<p><a target="_blank" href="https://www.instagram.com/techespm/">@techespm</a></p>\n\t<p><a target="_blank" href="https://www.instagram.com/arenas_espm/">@arenas_espm</a></p>\n\t</div>';
a.DecimalSeparator=".";a.OppositeDecimalSeparator=",";a.Success="Success!";a.Pause="Pause";a.Restart="Restart";a.Time="Time";a.Name="Name";return a}(),isIOSOrSafari=function(){if(0>=navigator.userAgent.indexOf("Chrome")&&0<=navigator.userAgent.indexOf("Safari")||0<=navigator.userAgent.indexOf("Mac")&&"ontouchend"in document)return!0;switch(navigator.platform){case "iPad Simulator":case "iPhone Simulator":case "iPod Simulator":case "iPad":case "iPhone":case "iPod":return!0}return!1}(),iconMarginEm=
.25,iconMarginCss="0.25em",smallMarginRem=.5,smallMarginCss="0.5rem",largeMarginRem=1,largeMarginCss="1rem",extraLargeMarginRem=1.5,extraLargeMarginCss="1.5rem",animationStartDelayMS=50,slowestAnimationTimeoutMS=1020,slowAnimationTimeoutMS=520,fastAnimationTimeoutMS=320,fastestAnimationTimeoutMS=120,blinkLastCounter=7,blinkSingleDurationMS=75,blinkTotalDurationMS=(blinkLastCounter+1)*blinkSingleDurationMS,baseWidth=1280,baseHeight=720,alienWidthRem=3.361930295,alienHeightRem=3.361930295,alienWidthCss=
alienWidthRem+"rem",alienHeightCss=alienHeightRem+"rem",baseFontSize=32,baseHeightFontUnits=baseHeight/baseFontSize|0,iconSize=32,Icon=function(){function a(){}a.change=function(c,b){c.setAttribute(a.DataId,b.toString());c.textContent=String.fromCharCode(b)};a.create=function(c,b,d){var e=document.createElement("span");e.className=d?"ui-icon no-margin":"ui-icon";a.change(e,c);b&&b.appendChild(e);return e};a.html=function(c,b){return'<span class="'+(b?"ui-icon no-margin":"ui-icon")+'" '+a.DataId+'="'+
c+'">'+String.fromCharCode(c)+"</span>"};a.DataId="data-icon-id";a.ScrollThumb=59651;a.Accept=59650;a.Clear=59649;a.Back=59648;a.Ball=257;a.Goal=65793;a.Bomb=131329;a.Cucumber=196865;a.Edit=262401;a.Question=327937;a.DeviceH=16777473;a.DeviceV=16843009;a.Hand=16908545;a.Fullscreen=16974081;a.Restart=17039617;a.Open=17105153;a.AcceptGreen=33554689;a.ClearRed=33685761;a.Border=33882369;a.LineWidth0=50331905;a.LineWidth1=50397441;a.LineWidth2=50462977;a.LineWidth3=50528513;a.Eraser=67109121;a.Rainbow=
67174657;a.Pause=67240193;a.Play=67305729;a.PlayGreen=83886337;a.Exit=83951873;a.Menu=84017409;a.Download=84082945;a.Success=100663553;a.Error=100729089;a.Trophy=100794625;a.Clock=100860161;a.DeviceHI=100925697;a.DeviceVI=100991233;return a}(),FullscreenControl=function(){function a(){}a.requestFullscreen=function(c){c||(c=document.body);var b=!0,d=null;try{c.requestFullscreen?d=c.requestFullscreen():c.webkitRequestFullscreen?d=c.webkitRequestFullscreen():c.mozRequestFullScreen?d=c.mozRequestFullScreen():
c.msRequestFullscreen?d=c.msRequestFullscreen():b=!1}catch(e){b=!1}b||c===document.body?ignorePromise(d):a.requestFullscreen()};a.exitFullscreen=function(){var c=null;try{document.exitFullscreen?c=document.exitFullscreen():document.webkitExitFullscreen?c=document.webkitExitFullscreen():document.mozExitFullScreen?c=document.mozExitFullScreen():document.msExitFullscreen&&(c=document.msExitFullscreen())}catch(b){}ignorePromise(c)};Object.defineProperty(a,"fullscreenElement",{get:function(){var c=null;
try{"fullscreenElement"in document&&(c=document.fullscreenElement),!c&&"webkitFullscreenElement"in document&&(c=document.webkitFullscreenElement),!c&&"mozFullscreenElement"in document&&(c=document.mozFullscreenElement),!c&&"msFullscreenElement"in document&&(c=document.msFullscreenElement)}catch(b){}return c},enumerable:!1,configurable:!0});Object.defineProperty(a.prototype,"onfullscreenchange",{get:function(){try{if("onfullscreenchange"in document)return document.onfullscreenchange;if("onwebkitfullscreenchange"in
document)return document.onwebkitfullscreenchange;if("onmozfullscreenchange"in document)return document.onmozfullscreenchange;if("onmsfullscreenchange"in document)return document.onmsfullscreenchange}catch(c){}return null},enumerable:!1,configurable:!0});Object.defineProperty(a,"onfullscreenchange",{set:function(c){try{"onfullscreenchange"in document&&(document.onfullscreenchange=c),"onwebkitfullscreenchange"in document&&(document.onwebkitfullscreenchange=c),"onmozfullscreenchange"in document&&(document.onmozfullscreenchange=
c),"onmsfullscreenchange"in document&&(document.onmsfullscreenchange=c)}catch(b){}},enumerable:!1,configurable:!0});a.toggleFullscreen=function(){a.fullscreenMode=!a.fullscreenMode};Object.defineProperty(a,"fullscreenMode",{get:function(){return!!a.fullscreenElement},set:function(c){c?a.requestFullscreen():a.exitFullscreen()},enumerable:!1,configurable:!0});return a}(),PointerHandler=function(){function a(c,b,d,e,g,f){void 0===b&&(b=null);void 0===d&&(d=null);void 0===e&&(e=null);void 0===g&&(g=!0);
void 0===f&&(f=null);this.documentTarget=document.documentElement||document.body;this.element=c;this.downCallback=b;this.moveCallback=d;this.upCallback=e;this.boundExtraTouchStart=null;"onpointerdown"in c?(this.documentDownEvent="pointerdown",this.documentMoveEvent="pointermove",this.documentUpEvent="pointerup",this.documentCancelEvent="pointercancel",this.boundDocumentDown=this.pointerDown.bind(this),this.boundDocumentUp=this.pointerUp.bind(this),this.boundDocumentMove=this.pointerMove.bind(this),
"ontouchstart"in c&&(this.boundExtraTouchStart=this.extraTouchStart.bind(this))):"ontouchstart"in c?(this.documentDownEvent="touchstart",this.documentMoveEvent="touchmove",this.documentUpEvent="touchend",this.documentCancelEvent="touchcancel",this.boundDocumentDown=this.touchStart.bind(this),this.boundDocumentUp=this.touchEnd.bind(this),this.boundDocumentMove=this.touchMove.bind(this)):(this.documentDownEvent="mousedown",this.documentMoveEvent="mousemove",this.documentUpEvent="mouseup",this.documentCancelEvent=
null,this.boundDocumentDown=this.mouseDown.bind(this),this.boundDocumentUp=this.mouseUp.bind(this),this.boundDocumentMove=this.mouseMove.bind(this));this.lazy=g;this.outsidePointerHandler=f;this.boundExtraTouchStart&&c.addEventListener("touchstart",this.boundExtraTouchStart);c.addEventListener(this.documentDownEvent,this.boundDocumentDown);g||this.addSecondaryHandlers();this._captured=!1;this.pointerId=-1}a.prototype.destroy=function(){this.element&&(this.boundExtraTouchStart&&this.element.removeEventListener("touchstart",
this.boundExtraTouchStart),this.boundDocumentDown&&this.element.removeEventListener(this.documentDownEvent,this.boundDocumentDown));this.removeSecondaryHandlers();this.mouseUp({});zeroObject(this)};Object.defineProperty(a.prototype,"captured",{get:function(){return this._captured},enumerable:!1,configurable:!0});a.prototype.addSecondaryHandlers=function(){this.documentTarget&&(this.documentTarget.addEventListener(this.documentMoveEvent,this.boundDocumentMove,{capture:!0,passive:!1}),this.documentTarget.addEventListener(this.documentUpEvent,
this.boundDocumentUp,!0),this.documentCancelEvent&&this.documentTarget.addEventListener(this.documentCancelEvent,this.boundDocumentUp,!0))};a.prototype.removeSecondaryHandlers=function(){this.documentTarget&&(this.boundDocumentUp&&(this.documentTarget.removeEventListener(this.documentUpEvent,this.boundDocumentUp,!0),this.documentCancelEvent&&this.documentTarget.removeEventListener(this.documentCancelEvent,this.boundDocumentUp,!0)),this.boundDocumentMove&&this.documentTarget.removeEventListener(this.documentMoveEvent,
this.boundDocumentMove,!0))};a.prototype.extraTouchStart=function(c){if(c.target===this.element||this.outsidePointerHandler&&this.outsidePointerHandler(c))return cancelEvent(c)};a.prototype.pointerDown=function(c){if(0<=this.pointerId&&"mouse"!==c.pointerType)return cancelEvent(c);var b=this.mouseDown(c);this._captured&&(this.pointerId=c.pointerId);return b};a.prototype.pointerMove=function(c){if(this._captured&&c.pointerId===this.pointerId)return this.mouseMove(c)};a.prototype.pointerUp=function(c){if(this._captured&&
c.pointerId===this.pointerId)return this.pointerId=-1,this.mouseUp(c)};a.prototype.touchStart=function(c){if(!(1<c.touches.length))return 0<=this.pointerId&&this.touchEnd(c),this.pointerId=1,c.clientX=c.touches[0].clientX,c.clientY=c.touches[0].clientY,c=this.mouseDown(c),void 0===c&&(this.pointerId=-1),c};a.prototype.touchMove=function(c){if(this._captured&&!(1<c.touches.length))return c.clientX=c.touches[0].clientX,c.clientY=c.touches[0].clientY,this.mouseMove(c)};a.prototype.touchEnd=function(c){if(this._captured&&
!(0>this.pointerId))return this.pointerId=-1,this.mouseUp(c)};a.prototype.mouseDown=function(c){this.mouseUp(c);if(!c.button&&!View.fading&&(!c.target||c.target===this.element||this.outsidePointerHandler&&this.outsidePointerHandler(c))){if(this.downCallback&&!this.downCallback(c))return cancelEvent(c);this._captured=!0;this.lazy&&this.addSecondaryHandlers();return cancelEvent(c)}};a.prototype.mouseMove=function(c){if(this._captured)return this.moveCallback&&this.moveCallback(c),cancelEvent(c)};a.prototype.mouseUp=
function(c){if(this._captured)return this._captured=!1,this.lazy&&this.removeSecondaryHandlers(),this.upCallback&&this.upCallback(c),cancelEvent(c)};return a}(),Modal=function(){function a(c){var b=this;this.options=c;this.containerElement=document.createElement("div");this.containerElement.className="base-element modal-container";this.modalElement=document.createElement("div");this.modalElement.className=c.large?"modal large":"modal";c.error&&(this.modalElement.className+=" error");"string"===typeof c.html?
this.modalElement.innerHTML=c.html:this.modalElement.appendChild(c.html);this.containerElement.appendChild(this.modalElement);document.body.appendChild(this.containerElement);this.boundDocumentKeyDown=this.documentKeyDown.bind(this);document.addEventListener("keydown",this.boundDocumentKeyDown,!0);this.fading=!0;window.setTimeout(function(){if(c.onshowing)c.onshowing();b.resizeInternal();b.containerElement.classList.add("visible");window.setTimeout(function(){b.fading=!1;b.containerElement.onclick=
a.hide;View.pushHistoryStateIfNecessary();if(b.options.onshown)b.options.onshown()},slowAnimationTimeoutMS)},animationStartDelayMS)}Object.defineProperty(a,"visible",{get:function(){return!!a.modal},enumerable:!1,configurable:!0});Object.defineProperty(a,"currentModalElement",{get:function(){return a.modal?a.modal.modalElement:null},enumerable:!1,configurable:!0});a.show=function(c){if(a.modal)return!1;a.modal=new a(c);return!0};a.hide=function(){a.modal&&a.modal.hideInternal()};a.defaultCancelAction=
function(){a.modal&&a.modal.hideInternal()};a.windowResized=function(){a.modal&&a.modal.resizeInternal()};a.prototype.hideInternal=function(){var c=this;a.modal!==this||this.fading||this.options.onhiding&&!1===this.options.onhiding()||(document.removeEventListener("keydown",this.boundDocumentKeyDown,!0),this.fading=!0,this.containerElement.classList.remove("visible"),window.setTimeout(function(){a.modal=null;View.popHistoryStateIfNecessary();if(c.options.onhidden)c.options.onhidden();document.body.removeChild(c.containerElement);
zeroObject(c.options);zeroObject(c)},slowAnimationTimeoutMS))};a.prototype.documentKeyDown=function(c){"Escape"!==c.key&&27!==c.keyCode||this.hideInternal()};a.prototype.resizeInternal=function(){if(a.modal===this&&this.options.onresized)this.options.onresized()};a.modal=null;return a}(),Alien=function(){function a(c,b){if("number"===typeof c){if(c<a.KindMin||c>a.KindMax)throw Error("Invalid alien kind");this.kind=a.Kinds[c]}else this.kind=c;this.element=document.createElement("div");this.element.className=
"alien";this.element.style.width=alienWidthCss;this.element.style.height=alienHeightCss;this.element.style.backgroundImage="url("+this.kind.imageUrl+")";this.element.style.backgroundSize=this.kind.cols*alienWidthRem+"rem "+this.kind.rows*alienHeightRem+"rem";this.element.alien=this;this.paused=!1;this.frame=Math.random()*this.kind.frames;this.frameInteger=this.frame|0;this._placement=void 0===b?-1:b;this.updateDOM()}a.preloadAllImages=function(){for(var c=Array(a.Kinds.length),b=a.Kinds.length-1;0<=
b;b--)c[b]=preloadImage(a.Kinds[b].imageUrl);return Promise.all(c)};a.create=function(c,b,d){c===a.KindRandom&&(c=a.KindMax-a.KindMin+1,c=a.KindMin+(Math.random()*c*c*c|0)%c);d=new a(c,d);a.aliens.push(d);b&&b.appendChild(d.element);return d};a.destroyAll=function(){for(var c=a.aliens.length-1;0<=c;c--)a.aliens[c].destroy(!0);a.aliens.splice(0)};a.stepAll=function(c){c*=.012;for(var b=a.aliens,d=b.length-1;0<=d;d--)b[d].updateDOM(c)};a.fromElement=function(c){return c?c.alien||null:null};Object.defineProperty(a.prototype,
"placement",{get:function(){return this._placement},enumerable:!1,configurable:!0});a.prototype.updateDOM=function(c){if(!this.paused&&this.element){if(c){this.frame=(this.frame+c)%this.kind.frames;c=this.frame|0;if(this.frameInteger===c)return;this.frameInteger=c}else c=this.frameInteger;var b=this.kind.cols;this.element.style.backgroundPosition="-"+c%b*alienWidthRem+"rem -"+(c/b|0)*alienHeightRem+"rem"}};a.prototype.shrink=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(b){switch(b.label){case 0:return this.element?[4,delay((c||0)+animationStartDelayMS)]:[2];case 1:b.sent();if(!this.element)return[2];this.element.classList.remove("full-size");return[2,delay(slowAnimationTimeoutMS)]}})})};a.prototype.grow=function(c){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){switch(b.label){case 0:return this.element?[4,delay((c||0)+animationStartDelayMS)]:[2];case 1:b.sent();if(!this.element)return[2];this.element.classList.add("full-size");
return[2,delay(slowAnimationTimeoutMS)]}})})};a.prototype.destroy=function(c){this.element&&(this.element.alien=null,this.element.parentNode&&this.element.parentNode.removeChild(this.element));c||(c=a.aliens.indexOf(this),0<=c&&a.aliens.splice(c,1));zeroObject(this)};a.KindRandom=-1;a.KindBlack=0;a.KindBlue=1;a.KindGreen=2;a.KindIndigo=3;a.KindOrange=4;a.KindPink=5;a.KindRed=6;a.KindYellow=7;a.KindMin=a.KindBlack;a.KindMax=a.KindYellow;a.KindCount=a.KindYellow+1;a.Kinds=[{id:a.KindBlack,imageUrl:"assets/images/aliens/black.png",
rows:4,cols:3,frames:10},{id:a.KindBlue,imageUrl:"assets/images/aliens/blue.png",rows:4,cols:3,frames:12},{id:a.KindGreen,imageUrl:"assets/images/aliens/green.png",rows:5,cols:4,frames:20},{id:a.KindIndigo,imageUrl:"assets/images/aliens/indigo.png",rows:5,cols:5,frames:22},{id:a.KindOrange,imageUrl:"assets/images/aliens/orange.png",rows:3,cols:3,frames:9},{id:a.KindPink,imageUrl:"assets/images/aliens/pink.png",rows:6,cols:5,frames:29},{id:a.KindRed,imageUrl:"assets/images/aliens/red.png",rows:7,cols:6,
frames:40},{id:a.KindYellow,imageUrl:"assets/images/aliens/yellow.png",rows:4,cols:4,frames:16}];a.aliens=[];return a}(),View=function(){function a(){var c=this;this.destroy=function(b){return __awaiter(c,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:if(!this.baseElement)return[3,3];this.baseElement.parentNode&&this.attached&&this.baseElement.parentNode.removeChild(this.baseElement);if(!this.attached)return[3,2];this.attached=!1;return[4,this.detach()];case 1:d.sent(),
d.label=2;case 2:this.destroyInternal(b),b||zeroObject(this),d.label=3;case 3:return[2]}})})};this.baseElement=document.createElement("div");this.baseElement.className="base-element";this.attached=!1}Object.defineProperty(a,"loading",{get:function(){return a._loading},set:function(c){a._loading!==c&&((a._loading=c)?(a.divLoading||(a.divLoading=document.createElement("div"),a.divLoading.style.display="none",document.body.appendChild(a.divLoading)),a.divLoadingTimeout&&clearTimeout(a.divLoadingTimeout),
a.divLoadingTimeout=window.setTimeout(function(){a.divLoadingTimeout=0;a.divLoading&&(a.divLoading.style.display="",a.divLoading.className="loading")},100)):a.divLoading&&(a.divLoadingTimeout&&(clearTimeout(a.divLoadingTimeout),a.divLoadingTimeout=0),document.body.removeChild(a.divLoading),a.divLoading=null))},enumerable:!1,configurable:!0});Object.defineProperty(a,"fading",{get:function(){return a._fading},enumerable:!1,configurable:!0});a.createInitialView=function(){return a.currentView||a._loading||
a._fading||a.viewStack.length?null:(new TitleView).fadeIn()};a.windowResized=function(c){c&&a.currentView&&a.currentView.resize()};a.windowHistoryStatePopped=function(c){a.windowHistoryStatePushed=!1;a.pushHistoryStateIfNecessary();Modal.visible&&Modal.defaultCancelAction()};a.pushHistoryStateIfNecessary=function(){a.windowHistoryStatePushed||a.currentView&&a.currentView instanceof TitleView&&!a._fading&&!Modal.visible||(a.windowHistoryStatePushed=!0,window.history.pushState({spaceTrain:!0},"Space Train"))};
a.popHistoryStateIfNecessary=function(){a.windowHistoryStatePushed&&window.history.back()};a.createHorizontalSpacer=function(c,b,d){var e=d?c.querySelector("#"+d):document.createElement("div");e.className="horizontal-spacer";e.style.width=b+"rem";d||c.appendChild(e);return e};a.createVerticalSpacer=function(c,b,d){var e=d?c.querySelector("#"+d):document.createElement("div");e.className="vertical-spacer";e.style.height=b+"rem";d||c.appendChild(e);return e};a.createButton=function(c,b,d){for(var e=
[],g=3;g<arguments.length;g++)e[g-3]=arguments[g];g=document.createElement("button");var f="string"===typeof b?b:"number"===typeof b?null:b.text||null,h="string"===typeof b?0:"number"===typeof b?b:b.imageId||0;h&&Icon.create(h,g,!f);g.setAttribute("type","button");d&&prepareButtonBlink(g,!1,d);c&&c.appendChild(g);f&&g.appendChild(document.createTextNode(f));if(e)for(f=0;f<e.length;f+=2)g.setAttribute(e[f],e[f+1]);return g};a.createBlackButton=function(c,b,d,e){for(var g=[],f=4;f<arguments.length;f++)g[f-
4]=arguments[f];f=[c,b,d];g&&g.length&&f.push.apply(f,g);f.push("class");f.push("black "+(e||""));return a.createButton.apply(this,f)};a.createWhiteButton=function(c,b,d,e){for(var g=[],f=4;f<arguments.length;f++)g[f-4]=arguments[f];f=[c,b,d];g&&g.length&&f.push.apply(f,g);f.push("class");f.push("white "+(e||""));return a.createButton.apply(this,f)};a.createBlueButton=function(c,b,d,e){for(var g=[],f=4;f<arguments.length;f++)g[f-4]=arguments[f];f=[c,b,d];g&&g.length&&f.push.apply(f,g);f.push("class");
f.push("blue "+(e||""));return a.createButton.apply(this,f)};a.createGreenButton=function(c,b,d,e){for(var g=[],f=4;f<arguments.length;f++)g[f-4]=arguments[f];f=[c,b,d];g&&g.length&&f.push.apply(f,g);f.push("class");f.push("green "+(e||""));return a.createButton.apply(this,f)};a.createOrangeButton=function(c,b,d,e){for(var g=[],f=4;f<arguments.length;f++)g[f-4]=arguments[f];f=[c,b,d];g&&g.length&&f.push.apply(f,g);f.push("class");f.push("orange "+(e||""));return a.createButton.apply(this,f)};a.createRedButton=
function(c,b,d,e){for(var g=[],f=4;f<arguments.length;f++)g[f-4]=arguments[f];f=[c,b,d];g&&g.length&&f.push.apply(f,g);f.push("class");f.push("red "+(e||""));return a.createButton.apply(this,f)};a.createPinkButton=function(c,b,d,e){for(var g=[],f=4;f<arguments.length;f++)g[f-4]=arguments[f];f=[c,b,d];g&&g.length&&f.push.apply(f,g);f.push("class");f.push("pink "+(e||""));return a.createButton.apply(this,f)};a.prototype.releaseResources=function(){};a.prototype.loadResources=function(){};a.prototype.resize=
function(){};a.prototype.fadeInFinished=function(){};a.prototype.finishFadeIn=function(c){var b=this;window.setTimeout(function(){b.resize();a.cover.classList.remove("visible");window.setTimeout(function(){a._fading=!1;a.popHistoryStateIfNecessary();document.body.removeChild(a.cover);b.fadeInFinished();c()},slowAnimationTimeoutMS)},animationStartDelayMS)};a.prototype.fadeIn=function(){var c=this;if(a._fading||a.currentView===this)return null;a._fading=!0;a.currentView=this;return new Promise(function(b){if(c.baseElement&&
!c.attached){a.main.appendChild(c.baseElement);c.attached=!0;var d=c.attach();if(d){d.then(function(){c.finishFadeIn(b)},function(e){console.error(e)});return}}c.finishFadeIn(b)})};a.prototype.fadeOut=function(c){var b=this;if(a._fading||a.currentView!==this)return null;a._fading=!0;return new Promise(function(d){document.body.appendChild(a.cover);window.setTimeout(function(){a.cover.classList.add("visible");window.setTimeout(function(){return __awaiter(b,void 0,void 0,function(){return __generator(this,
function(e){switch(e.label){case 0:return[4,this.destroy(c)];case 1:return e.sent(),c&&a.viewStack.push(this),a.currentView=null,a._fading=!1,a.pushHistoryStateIfNecessary(),d(),[2]}})})},slowAnimationTimeoutMS)},animationStartDelayMS)})};a.prototype.fadeTo=function(c,b){void 0===b&&(b=!1);return a._fading||a.currentView!==this?null:(b=this.fadeOut(b))?b.then(function(){var d=c().fadeIn();if(d)return d}):null};a.prototype.fadeToPrevious=function(){if(a._fading||a.currentView!==this||!a.viewStack.length)return null;
var c=this.fadeOut(!1);return c?c.then(function(){var b=a.viewStack.pop().fadeIn();if(b)return b}):null};a.main=document.getElementById("main");a.cover=document.getElementById("cover");a._loading=!1;a._fading=!1;a.mainLandscape=!1;a.currentView=null;a.viewStack=[];a.divLoading=null;a.divLoadingTimeout=0;a.windowHistoryStatePushed=!1;return a}(),CreditsView=function(a){function c(){var b=a.call(this)||this,d=View.createWhiteButton(b.baseElement,{imageId:Icon.Clear,text:Strings.Close},b.back.bind(b),
"small");d.style.position="absolute";d.style.left=extraLargeMarginCss;d.style.top=extraLargeMarginCss;d=document.createElement("div");d.className="text-center";d.style.paddingLeft=smallMarginCss;d.style.paddingRight=smallMarginCss;d.style.paddingBottom=smallMarginCss;d.innerHTML=Strings.CreditsHTML;b.baseElement.appendChild(d);b.textProtection=document.createElement("div");b.textProtection.className="text-protection";return b}__extends(c,a);c.prototype.attach=function(){return __awaiter(this,void 0,
void 0,function(){return __generator(this,function(b){document.body.insertBefore(this.textProtection,document.body.firstChild);return[2]})})};c.prototype.detach=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){document.body.removeChild(this.textProtection);return[2]})})};c.prototype.destroyInternal=function(b){};c.prototype.back=function(b){this.fadeToPrevious();return!0};return c}(View),GameView=function(a){function c(){var b=a.call(this)||this;b.baseElement.classList.add("text-center");
var d=View.createWhiteButton(b.baseElement,{imageId:Icon.Clear,text:Strings.Close},b.back.bind(b),"small");d.style.position="absolute";d.style.left=extraLargeMarginCss;d.style.top=extraLargeMarginCss;d=View.createBlueButton(b.baseElement,{imageId:Icon.Accept,text:Strings.NextRound},b.nextRound.bind(b),"fade small visible");d.setAttribute("disabled","disabled");d.style.position="absolute";d.style.right=extraLargeMarginCss;d.style.top=extraLargeMarginCss;b.nextRoundButton=d;d=document.createElement("div");
d.style.pointerEvents="none";d.style.marginTop=alienHeightRem+extraLargeMarginRem+"rem";d.style.height=alienHeightCss;b.shelf=d;b.baseElement.appendChild(d);d=document.createElement("div");d.className="train";b.alienRow=d;for(var e=c.MaximumAlienCount-1;0<=e;e--){var g=document.createElement("div");g.className="target";d.appendChild(g)}b.baseElement.appendChild(d);d=document.createElement("div");d.className="result-label";b.resultLabel=d;e=document.createElement("span");e.className="round";d.appendChild(e);
b.resultLabelRound=e;g=Array(c.TotalRoundCount);for(e=0;e<c.TotalRoundCount;e++){var f=document.createElement("span");f.className="marker";d.appendChild(f);g[e]=f;var h=document.createElement("span");h.className="points";f.appendChild(h)}b.resultLabelMarker=g;e=document.createElement("span");e.className="total";d.appendChild(e);b.resultLabelTotal=e;e=document.createElement("div");e.className="row2";e.innerHTML='<s>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</s><img src="assets/images/logo-small.png" /><s>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</s>';
d.appendChild(e);b.baseElement.appendChild(d);b.musicButton=View.createWhiteButton(b.baseElement,musicPlaying?Strings.StopMusic:Strings.PlayMusic,toggleMusic,"fade small visible");b.musicButton.style.position="absolute";b.musicButton.style.left=extraLargeMarginCss;b.musicButton.style.bottom=extraLargeMarginCss;b.baseElement.appendChild(b.musicButton);b.alive=!0;b.animating=!1;b.frameRequest=0;b.lastTime=0;b.pointerHandler=null;b.movingAlien=null;b.movingInitialX=0;b.movingInitialY=0;b.round=0;b.points=
0;b.lastPlacedAlien=0;b.originalAlienPlacement=-1;b.boundMouseDown=b.mouseDown.bind(b);b.boundMouseMove=b.mouseMove.bind(b);b.boundMouseUp=b.mouseUp.bind(b);b.boundOutsidePointerHandler=b.outsidePointerHandler.bind(b);b.boundRender=b.render.bind(b);return b}__extends(c,a);c.prototype.attach=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){musicButton=this.musicButton;updateMusicButton();this.lastTime=performance.now();this.alive=!0;this.pointerHandler=
new PointerHandler(this.baseElement,this.boundMouseDown,this.boundMouseMove,this.boundMouseUp,!1,this.boundOutsidePointerHandler);return[2]})})};c.prototype.detach=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){musicButton=null;this.alive=!1;this.pointerHandler&&(this.pointerHandler.destroy(),this.pointerHandler=null);this.frameRequest&&(cancelAnimationFrame(this.frameRequest),this.frameRequest=0);return[2]})})};c.prototype.destroyInternal=function(b){b||
Alien.destroyAll()};c.prototype.fadeInFinished=function(){this.frameRequest&&(cancelAnimationFrame(this.frameRequest),this.frameRequest=0);this.frameRequest=requestAnimationFrame(this.boundRender);this.restart()};c.prototype.back=function(b){this.fadeTo(function(){return new TitleView});return!0};c.prototype.displayAddedPoints=function(b,d){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(g){switch(g.label){case 0:d&&1<this.round&&this.round<=c.TotalRoundCount&&
(this.resultLabelMarker[this.round-2].firstChild.textContent=b.toString());if(!b)return[2];e=document.createElement("div");e.className="added-points";e.textContent="+ "+b+" "+(1===b?Strings.point:Strings.points)+"!";this.baseElement.appendChild(e);return[4,delay(animationStartDelayMS)];case 1:g.sent();if(!this.alive)return[2];e.classList.add("fading");return[4,delay(1500)];case 2:g.sent();if(!this.alive)return[2];this.baseElement.removeChild(e);return[2]}})})};c.prototype.generateNewAliens=function(b){return __awaiter(this,
void 0,void 0,function(){var d,e,g,f,h,m,k,l,n,q;return __generator(this,function(p){switch(p.label){case 0:d=c.MaximumAlienCount;e=this.shelf;g=e.getElementsByClassName("alien");f=75;if(!g.length)return[3,2];d=0;h=[];m=[];k=g.length-1;for(l=0;0<=k;k--,l+=f)if(n=Alien.fromElement(g[k]))n.paused||(h.push(n.shrink(l)),d++),m.push(n);this.resultLabel.classList.contains("visible")&&(this.resultLabel.classList.remove("visible"),h.push(delay(slowAnimationTimeoutMS)));return[4,Promise.all(h)];case 1:p.sent();
if(!this.alive)return[2];for(k=m.length-1;0<=k;k--)m[k].destroy();return[3,4];case 2:if(!this.resultLabel.classList.contains("visible"))return[3,4];this.resultLabel.classList.remove("visible");return[4,delay(slowAnimationTimeoutMS)];case 3:p.sent();if(!this.alive)return[2];p.label=4;case 4:this.displayAddedPoints(b,!0);q=Array(d);k=d-1;for(l=0;0<=k;k--,l+=f)n=Alien.create(Alien.KindRandom,e),q[k]=n.grow(l);for(k=c.TotalRoundCount;1<=k;k--)k>this.round?this.resultLabelMarker[k-1].classList.remove("done"):
this.resultLabelMarker[k-1].classList.add("done"),k>=this.round&&(this.resultLabelMarker[k-1].firstChild.textContent="");this.resultLabelRound.textContent=Strings.Round+this.round;this.resultLabelTotal.textContent=Strings.Total+this.points;return[4,delay(animationStartDelayMS)];case 5:p.sent();if(!this.alive)return[2];this.resultLabel.classList.add("visible");return[4,Promise.all(q)];case 6:p.sent();if(!this.alive)return[2];this.animating=!1;return[2]}})})};c.prototype.restart=function(){return __awaiter(this,
void 0,void 0,function(){var b,d,e,g,f;return __generator(this,function(h){switch(h.label){case 0:if(!this.alive||this.animating||this.movingAlien)return[2];this.nextRoundButton.setAttribute("disabled","disabled");this.nextRoundButton.replaceChild(document.createTextNode(Strings.NextRound),this.nextRoundButton.childNodes[1]);this.animating=!0;b=this.baseElement.getElementsByClassName("alien");d=[];e=b.length-1;for(g=0;0<=e;e--,g+=75)(f=Alien.fromElement(b[e]))&&!f.paused&&d.push(f.shrink(g));return[4,
Promise.all(d)];case 1:h.sent();if(!this.alive)return[2];Alien.destroyAll();this.animating=!1;this.lastPlacedAlien=this.points=this.round=0;this.originalAlienPlacement=-1;this.nextRound();return[2]}})})};c.prototype.showMessage=function(b,d){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(g){if(this.animating)return[2];this.animating=!0;return[2,new Promise(function(f){return __awaiter(e,void 0,void 0,function(){var h=this;return __generator(this,function(m){Modal.show({html:d,
error:b,onhidden:function(){h.alive&&(h.animating=!1,f())}});return[2]})})})]})})};c.prototype.gameOver=function(b){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(d){switch(d.label){case 0:return[4,this.showMessage(!0,b)];case 1:d.sent();if(!this.alive)return[2];this.animating=!0;return[4,delay(slowAnimationTimeoutMS)];case 2:d.sent();if(!this.alive)return[2];this.animating=!1;return[2,this.restart()]}})})};c.prototype.gameFinished=function(b,d,e){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(g){switch(g.label){case 0:return this.animating=!0,this.resultLabel.classList.remove("visible"),[4,delay(fastAnimationTimeoutMS)];case 1:g.sent();if(!this.alive)return[2];this.round++;return[4,this.displayAddedPoints(b,!1)];case 2:g.sent();if(!this.alive)return[2];this.animating=!1;return[4,this.showMessage(!1,Strings.Victory.replace("{totalPoints}",this.points.toString()).replace("{regularPoints}",(this.points-e).toString()).replace("{extraPoints}",
e.toString())+d+(1===d?Strings.VictorySpeciesSingular:Strings.VictorySpeciesPlural))];case 3:g.sent();if(!this.alive)return[2];this.restart();return[2]}})})};c.prototype.computeAddedPoints=function(){if(!this.alienRow)return 0;for(var b=this.alienRow.getElementsByClassName("alien"),d=Alien.KindRandom,e=0,g=0,f=b.length-1;0<=f;f--){var h=Alien.fromElement(b[f]);h&&(h=h.kind.id,d===h?e++:(g+=c.PointsPerSequence[e],e=1,d=h))}return g+c.PointsPerSequence[e]};c.prototype.computeExtraPoints=function(){if(!this.alienRow)return{typeCount:0,
extraPoints:0};var b=this.alienRow.getElementsByClassName("alien"),d=Array(Alien.KindCount);d.fill(0);for(var e=0,g=b.length-1;0<=g;g--){var f=Alien.fromElement(b[g]);f&&!d[f.kind.id]++&&e++}return{typeCount:e,extraPoints:3*e}};c.prototype.nextRound=function(){if(!this.alive||this.animating||this.movingAlien)return!1;var b=0;this.lastPlacedAlien&&(b=this.computeAddedPoints(),this.points+=b);if(this.lastPlacedAlien>=c.MaximumAlienCount){var d=this.computeExtraPoints(),e=d.typeCount;d=d.extraPoints;
this.points+=d;this.gameFinished(b+d,e,d);return!0}this.animating=!0;this.round++;this.nextRoundButton.setAttribute("disabled","disabled");this.generateNewAliens(b);return!0};c.prototype.mouseDown=function(b){if(!this.alive||this.animating)return!1;var d=b.clientX;b=b.clientY;for(var e=[this.shelf,this.alienRow],g=e.length-1;0<=g;g--){var f=e[g].getElementsByClassName("alien"),h=e[g].getBoundingClientRect();if(b>=h.top&&b<h.bottom&&f&&f.length)for(var m=f.length-1;0<=m;m--)if(h=f[m].getBoundingClientRect(),
d>=h.left&&d<h.right&&(h=Alien.fromElement(f[m]))&&h.element&&!h.paused)return h.element.classList.add("moving"),this.alienRow.classList.add("dragging"),this.movingInitialX=d,this.movingInitialY=b,this.movingAlien=h,this.originalAlienPlacement=h.placement,!0}return!1};c.prototype.mouseMove=function(b){this.movingAlien&&this.movingAlien.element&&(this.movingAlien.element.style.transform="translate("+(b.clientX-this.movingInitialX)+"px, "+(b.clientY-this.movingInitialY)+"px)")};c.prototype.mouseUp=
function(b){var d=this.movingAlien;if(d&&d.element){this.movingAlien=null;var e=this.alienRow,g=e.children,f=b.clientX;b=b.clientY;e.classList.remove("dragging");d.element.classList.remove("moving");d.element.style.transform="";e=e.getBoundingClientRect();if(b>=e.top&&b<e.bottom)for(b=g.length-1;0<=b;b--){var h=g[b];if(!(!h.classList.contains("target")||f<(e=h.getBoundingClientRect()).left||f>=e.right)){if(0<=this.originalAlienPlacement){this.originalAlienPlacement!==b&&this.gameOver(Strings.GameOverReposition);
break}if(this.lastPlacedAlien!==b){this.gameOver(Strings.GameOverFirstAvailable);break}if(h.childNodes.length){this.gameOver(Strings.GameOverReplace);break}d.paused=!0;d.element.style.visibility="hidden";Alien.create(d.kind,h,this.lastPlacedAlien).grow();this.lastPlacedAlien++;this.round<c.TotalRoundCount&&this.nextRoundButton.removeAttribute("disabled");this.lastPlacedAlien>=c.MaximumAlienCount&&(this.nextRoundButton.removeAttribute("disabled"),this.nextRoundButton.replaceChild(document.createTextNode(Strings.Finish),
this.nextRoundButton.childNodes[1]))}}}};c.prototype.outsidePointerHandler=function(b){return b.target&&"target"===b.target.className&&b.target.childNodes.length?!0:!1};c.prototype.render=function(b){if(this.alive){this.frameRequest=requestAnimationFrame(this.boundRender);var d=b-this.lastTime;this.lastTime=b;33<d&&(d=33);Alien.stepAll(d)}else this.frameRequest=0};c.TotalRoundCount=5;c.MaximumAlienCount=8;c.PointsPerSequence=[0,1,3,6,10,15,21,28,36];return c}(View),RulesView=function(a){function c(){var b=
a.call(this)||this;b.baseElement.classList.add("text-center");var d=View.createWhiteButton(b.baseElement,{imageId:Icon.Clear,text:Strings.Close},b.back.bind(b),"small");d.style.position="absolute";d.style.left=extraLargeMarginCss;d.style.top=extraLargeMarginCss;b.fadingRule=!1;b.currentRule=0;d=document.createElement("div");d.className="rule-container";var e=document.createElement("div");e.className="rule-prev fade";e.onclick=b.previousRule.bind(b);b.previousRuleButton=e;d.appendChild(e);e=document.createElement("img");
e.className="rule-image fade visible";e.src="assets/images/rule0.png";b.ruleImage=e;d.appendChild(e);e=document.createElement("div");e.className="rule-next fade visible";e.onclick=b.nextRule.bind(b);b.nextRuleButton=e;d.appendChild(e);b.baseElement.appendChild(d);d=document.createElement("div");d.className="result-label visible";e=Array(c.TotalRuleCount);for(var g=0;g<c.TotalRuleCount;g++){var f=document.createElement("span");f.className=g?"marker":"marker done";d.appendChild(f);e[g]=f;var h=document.createElement("span");
h.className="points";f.appendChild(h)}b.ruleMarker=e;e=document.createElement("div");e.className="row2";e.innerHTML='<s>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</s><img src="assets/images/logo-small.png" /><s>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</s>';d.appendChild(e);b.baseElement.appendChild(d);return b}__extends(c,a);c.prototype.attach=function(){return __awaiter(this,void 0,void 0,
function(){return __generator(this,function(b){return[2]})})};c.prototype.detach=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){return[2]})})};c.prototype.destroyInternal=function(b){};c.prototype.back=function(b){this.fadeToPrevious();return!0};c.prototype.changeRule=function(b){return __awaiter(this,void 0,void 0,function(){var d,e,g;return __generator(this,function(f){switch(f.label){case 0:if(View.fading||this.fadingRule||!this.ruleMarker)return[2];
d=this.currentRule+b;if(0>d||d>=c.TotalRuleCount)return[2];this.fadingRule=!0;0<d?this.previousRuleButton.classList.add("visible"):this.previousRuleButton.classList.remove("visible");d<c.TotalRuleCount-1?this.nextRuleButton.classList.add("visible"):this.nextRuleButton.classList.remove("visible");this.ruleImage.classList.remove("visible");return[4,delay(slowAnimationTimeoutMS)];case 1:f.sent();e=this.ruleMarker;for(g=0;g<c.TotalRuleCount;g++)g<=d?e[g].classList.add("done"):e[g].classList.remove("done");
this.ruleImage.src="assets/images/rule"+d+".png";this.ruleImage.classList.add("visible");this.currentRule=d;return[4,delay(slowAnimationTimeoutMS)];case 2:return f.sent(),this.fadingRule=!1,[2]}})})};c.prototype.previousRule=function(){this.changeRule(-1)};c.prototype.nextRule=function(){this.changeRule(1)};c.TotalRuleCount=5;return c}(View),TitleView=function(a){function c(){var b=a.call(this)||this;b.baseElement.innerHTML='\n\t\t<div style="margin: 2em 0;">\n\t\t\t<img id="logo" src="assets/images/logo.png" alt="Logo" class="fade" style="width: 20rem;" />\n\t\t</div>\n\t\t<div id="subtitle" class="fade" style="margin: 2em 0 1em;">\n\t\t\t<s>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</s>\n\t\t\t&nbsp;\n\t\t\tBLOCKCHAIN GAME\n\t\t\t&nbsp;\n\t\t\t<s>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</s>\n\t\t</div>\n\t\t';
b.baseElement.className="text-center";b.logo=b.baseElement.querySelector("#logo");b.subtitle=b.baseElement.querySelector("#subtitle");b.startButton=View.createBlueButton(b.baseElement,Strings.START,b.start.bind(b),"fade","data-teste","1");b.startButton.style.marginBottom=largeMarginCss;b.baseElement.appendChild(document.createElement("br"));b.rulesButton=View.createOrangeButton(b.baseElement,Strings.RULES,b.rules.bind(b),"fade");b.rulesButton.style.marginBottom=largeMarginCss;b.baseElement.appendChild(document.createElement("br"));
b.creditsButton=View.createPinkButton(b.baseElement,Strings.CREDITS,b.credits.bind(b),"fade");b.creditsButton.style.marginBottom=largeMarginCss;b.musicButton=View.createWhiteButton(b.baseElement,musicPlaying?Strings.StopMusic:Strings.PlayMusic,toggleMusic,"fade small");b.musicButton.style.position="absolute";b.musicButton.style.left=extraLargeMarginCss;b.musicButton.style.bottom=extraLargeMarginCss;b.fullscreenButton=View.createWhiteButton(b.baseElement,Strings.Fullscreen,b.fullscreen.bind(b),"fade small");
b.fullscreenButton.style.position="absolute";b.fullscreenButton.style.right=extraLargeMarginCss;b.fullscreenButton.style.bottom=extraLargeMarginCss;b.fadeSequence=0;b.fadeElements=null;b.fadeInterval=0;return b}__extends(c,a);c.prototype.attach=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(b){musicButton=this.musicButton;updateMusicButton();return[2]})})};c.prototype.detach=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(b){musicButton=null;this.fadeInterval&&(clearInterval(this.fadeInterval),this.fadeInterval=0);return[2]})})};c.prototype.destroyInternal=function(b){};c.prototype.fadeInFinished=function(){this.startFadeSequence(1)};c.prototype.startFadeSequence=function(b,d){var e=this;if(!this.fadeSequence){var g=[this.logo,this.subtitle,this.startButton,this.rulesButton,this.creditsButton,this.musicButton,this.fullscreenButton];0>b&&g.reverse();this.fadeSequence=b;this.fadeElements=g;this.fadeInterval=
window.setInterval(function(){var f=Math.abs(e.fadeSequence)-1;!e.fadeElements||f>=e.fadeElements.length?(clearInterval(e.fadeInterval),e.fadeSequence=0,e.fadeElements=null,e.fadeInterval=0,d&&d()):(f=e.fadeElements[f],0<e.fadeSequence?(f.classList.add("visible"),e.fadeSequence++):(f.classList.remove("visible"),e.fadeSequence--))},100)}};c.prototype.start=function(b){var d=this;if(Modal.visible||this.fadeSequence)return!1;this.startFadeSequence(-1,function(){return d.fadeTo(function(){return new GameView})});
return!0};c.prototype.rules=function(b){var d=this;if(this.fadeSequence)return!1;this.startFadeSequence(-1,function(){return d.fadeTo(function(){return new RulesView},!0)});return!0};c.prototype.credits=function(b){var d=this;if(this.fadeSequence)return!1;this.startFadeSequence(-1,function(){return d.fadeTo(function(){return new CreditsView},!0)});return!0};c.prototype.fullscreen=function(b){FullscreenControl.toggleFullscreen();return!0};return c}(View),scaleFactor=-1,widthCss=0,heightCss=0,baseLeftCss=
0,baseTopCss=0,fontSize=0,fontSizeCss="0px",musicPlaying=!1,audioContext=null,audioBuffer=null,audioBufferSource=null,bgMusic=null,musicButton=null,installationPrompt=null,landscapeWarning=null;function ignorePromise(a){try{var c=function(){};a&&a.then&&a.then(c,c)}catch(b){}}function cancelEvent(a){a&&("isCancelled"in a&&(a.isCancelled=!0),"preventDefault"in a&&a.preventDefault(),"stopPropagation"in a&&a.stopPropagation());return!1}function format2(a){return 10>a?"0"+a:a.toString()}
function rem2Px(a){return fontSize*a+"px"}function rem2PxNumber(a){return fontSize*a}function smoothStep(a){return a*a*(3-2*a)}function delay(a){return new Promise(function(c){return window.setTimeout(c,a)})}function handleBlink(a){var c=a[0],b=a[1];0<c&&c<blinkLastCounter?(b.style.visibility=c&1?"":"hidden",a[0]=c+1):abortBlink(b)}
function abortBlink(a){if(a){var c=a.getAttribute("data-blink-interval");c&&(a.setAttribute("data-blink-interval",""),(c=parseInt(c))&&clearInterval(c),a.style.visibility="")}}function blink(a){a&&(abortBlink(a),a.style.visibility="hidden",a.setAttribute("data-blink-interval",window.setInterval(handleBlink,blinkSingleDurationMS,[1,a]).toString()))}function prepareButtonBlink(a,c,b){a.onclick=function(d){View.loading||View.fading||!c&&Modal.visible||!b(d)||blink(a)}}
function zeroObject(a){for(var c in a)switch(typeof a[c]){case "function":break;case "boolean":a[c]=!1;break;case "number":a[c]=0;break;default:var b=a[c];Array.isArray(b)&&b.fill(null);a[c]=null}}
function adjustWindowSize(){widthCss=window.innerWidth;heightCss=window.innerHeight;document.documentElement&&"clientWidth"in document.documentElement&&(widthCss=document.documentElement.clientWidth,heightCss=document.documentElement.clientHeight);if(isIOSOrSafari){var a=null;document.documentElement&&"getBoundingClientRect"in document.documentElement?a=document.documentElement.getBoundingClientRect():"getBoundingClientRect"in document.body&&(a=document.body.getBoundingClientRect());a&&(widthCss=
a.right-a.left,heightCss=a.bottom-a.top)}a="scale("+Math.ceil(.25*widthCss)+","+Math.ceil(.25*heightCss)+")";var c=View.cover.style;c.oTransform=a;c.msTransform=a;c.mozTransform=a;c.webkitTransform=a;c.transform=a;a=scaleFactor;if(widthCss/heightCss>=baseWidth/baseHeight){var b=heightCss;scaleFactor=heightCss/baseHeight;c=widthCss}else c=widthCss,scaleFactor=widthCss/baseWidth,b=baseHeight*scaleFactor;baseLeftCss=.5*(widthCss-c)|0;0>baseLeftCss&&(baseLeftCss=0);baseTopCss=.5*(heightCss-b)|0;0>baseTopCss&&
(baseTopCss=0);View.main.style.left=baseLeftCss+"px";View.main.style.top=baseTopCss+"px";widthCss<=heightCss?landscapeWarning||(landscapeWarning=document.createElement("div"),landscapeWarning.style.pointerEvents="none",landscapeWarning.style.textAlign="center",landscapeWarning.style.position="absolute",landscapeWarning.style.left="0",landscapeWarning.style.top=smallMarginCss,landscapeWarning.style.width="100%",landscapeWarning.style.zIndex="9999",landscapeWarning.textContent=Strings.LandscapeWarning,
document.body.appendChild(landscapeWarning)):landscapeWarning&&(document.body.removeChild(landscapeWarning),landscapeWarning=null);View.main.style.width=c+"px";View.main.style.height=b+"px";scaleFactor!==a?(fontSize=b/baseHeightFontUnits|0,fontSizeCss=fontSize+"px",document.documentElement&&(document.documentElement.style.fontSize=fontSizeCss),document.body.style.fontSize=fontSizeCss,View.windowResized(!0)):View.windowResized(!1);Modal.windowResized()}
function beforeInstallPrompt(a){"preventDefault"in a&&a.preventDefault();installationPrompt=a}
function toggleMusic(a){if(bgMusic)musicPlaying===bgMusic.paused&&(musicPlaying=!musicPlaying),musicPlaying?(musicPlaying=!1,bgMusic.pause()):(musicPlaying=!0,bgMusic.play());else if(audioContext&&audioBuffer)try{audioBufferSource&&(audioBufferSource.stop(),audioBufferSource.disconnect(),audioBufferSource=null),musicPlaying?(audioContext.suspend(),musicPlaying=!1):(audioContext.resume(),audioBufferSource=audioContext.createBufferSource(),audioBufferSource.buffer=audioBuffer,audioBufferSource.loop=
!0,audioBufferSource.connect(audioContext.destination),audioBufferSource.start(),musicPlaying=!0)}catch(c){}a.target&&a.target.tagName&&(a.target.textContent=musicPlaying?Strings.StopMusic:Strings.PlayMusic);return!0}function updateMusicButton(){musicButton&&(musicButton.textContent=musicPlaying?Strings.StopMusic:Strings.PlayMusic)}var fullscreenChangedTimeout=0;
function fullscreenChanged(a){fullscreenChangedTimeout&&(clearTimeout(fullscreenChangedTimeout),fullscreenChangedTimeout=0);try{FullscreenControl.fullscreenMode?fullscreenChangedTimeout=setTimeout(fullscreenChangedHandler,150):fullscreenChangedHandler()}catch(c){}}
function fullscreenChangedHandler(){fullscreenChangedTimeout=0;if(screen.mozLockOrientation&&screen.mozUnlockOrientation)try{if(FullscreenControl.fullscreenMode){if(screen.mozLockOrientation("landscape-primary"))return}else if(screen.mozUnlockOrientation())return}catch(a){}if(screen.msLockOrientation&&screen.msUnlockOrientation)try{if(FullscreenControl.fullscreenMode){if(screen.msLockOrientation("landscape-primary"))return}else if(screen.msUnlockOrientation())return}catch(a){}if(screen.orientation&&
screen.orientation.lock&&screen.orientation.unlock)try{ignorePromise(FullscreenControl.fullscreenMode?screen.orientation.lock("landscape-primary"):screen.orientation.unlock())}catch(a){}}function preloadImage(a){return new Promise(function(c){var b=document.createElement("img");b.onload=function(){b.style.display="none";b.style.position="absolute";b.style.width="0";b.style.height="0";b.style.zIndex="-1";c()};b.onerror=function(){return c()};b.setAttribute("src",a)})}
function setup(){function a(){View.loading=!1;bgMusic&&(bgMusic.onplay=function(){musicPlaying=!0;updateMusicButton()},bgMusic.onpause=function(){musicPlaying=!1;updateMusicButton()});View.createInitialView()}Strings.init();View.loading=!0;"serviceWorker"in navigator&&window.addEventListener("beforeinstallprompt",beforeInstallPrompt);window.onpopstate=View.windowHistoryStatePopped;window.onresize=adjustWindowSize;adjustWindowSize();FullscreenControl.onfullscreenchange=fullscreenChanged;Promise.all([function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(c){bgMusic=document.createElement("audio");bgMusic.loop=!0;bgMusic.src="assets/sounds/bgfade.mp3";document.body.appendChild(bgMusic);bgMusic.load();return[2]})})}(),Alien.preloadAllImages()]).then(a,a)}window.spacetrainStepMAIN=!0;window.spacetrainCheckSetup&&window.spacetrainCheckSetup();
