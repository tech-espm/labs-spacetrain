'use strict';var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(f){return f instanceof c?f:new c(function(g){g(f)})}return new (c||(c=Promise))(function(f,g){function l(h){try{m(d.next(h))}catch(n){g(n)}}function k(h){try{m(d["throw"](h))}catch(n){g(n)}}function m(h){h.done?f(h.value):e(h.value).then(l,k)}m((d=d.apply(a,b||[])).next())})};
class Strings{static init(){const a=navigator.userLanguage||navigator.language;a&&0===a.toLowerCase().indexOf("pt")&&(document.documentElement.setAttribute("lang","pt-br"),Strings.LandscapeWarning="O jogo funciona melhor no modo paisagem :)",Strings.Cancel="Cancelar",Strings.Clear="Limpar",Strings.Close="Fechar",Strings.Exit="Sair",Strings.Play="Jogar",Strings.Edit="Editar",Strings.Delete="Excluir",Strings.NextRound="Pr\u00f3xima Rodada",Strings.Finish="Terminar!",Strings.of="de",Strings.Round="Rodada ",
Strings.point="ponto",Strings.points="pontos",Strings.Install="Instalar!",Strings.About="Sobre",Strings.PlayMusic="Tocar m\u00fasica",Strings.StopMusic="Parar m\u00fasica",Strings.Fullscreen="Tela Cheia",Strings.START="INICIAR",Strings.RULES="REGRAS",Strings.CREDITS="CR\u00c9DITOS",Strings.Victory="Sua pontua\u00e7\u00e3o final total foi {totalPoints}<br/>\n\t\t\t<br/>\n\t\t\t{regularPoints} pontos de aliens embarcados<br/>\n\t\t\t+<br/>\n\t\t\t{extraPoints} de b\u00f4nus por ",Strings.VictorySpeciesSingular=
" \u00fanica esp\u00e9cie",Strings.VictorySpeciesPlural=" esp\u00e9cies diferentes",Strings.GameOverReposition="N\u00e3o \u00e9 permitido reposicionar os alien\u00edgenas!",Strings.GameOverFirstAvailable="Um novo alien\u00edgena deve sempre ser embarcado na primeira posi\u00e7\u00e3o dispon\u00edvel!",Strings.GameOverReplace="N\u00e3o \u00e9 permitido substituir um alien\u00edgina j\u00e1 embarcado!",Strings.CreditsHTML='<h1 class="blue">GAME DESIGN</h2>\n\t\t\t<p>Vince Vader</p>\n\t\t\t<h1 class="green">PROGRAMA\u00c7\u00c3O</h2>\n\t\t\t<p>Carlos Rafael das Neves</p>\n\t\t\t<h1 class="orange">COORDENA\u00c7\u00c3O DE CRIA\u00c7\u00c3O</h2>\n\t\t\t<p>Eduardo Manente</p>\n\t\t\t<h1 class="red">COORDENA\u00c7\u00c3O DE PLANEJAMENTO</h2>\n\t\t\t<p>Eric de Carvalho</p>\n\t\t\t<h1 class="pink">LAYOUT E TRILHA SONORA</h2>\n\t\t\t<p>Camila Galastri Guedes</p>\n\t\t\t<p>Jo\u00e3o Pedro Rabelo</p>\n\t\t\t<p>Marcella Lizaso de Siqueira</p>\n\t\t\t<div class="insta">\n\t\t\t<h1>SIGA NO INSTA</h1>\n\t\t\t<p><a target="_blank" href="https://www.instagram.com/gamelab_espm/">@gamelab_espm</a></p>\n\t\t\t<p><a target="_blank" href="https://www.instagram.com/techespm/">@techespm</a></p>\n\t\t\t<p><a target="_blank" href="https://www.instagram.com/arenas_espm/">@arenas_espm</a></p>\n\t\t\t</div>',
Strings.DecimalSeparator=",",Strings.OppositeDecimalSeparator=".",Strings.Success="Sucesso!",Strings.Pause="Pausa",Strings.Restart="Reiniciar",Strings.Time="Tempo",Strings.Name="Nome")}}Strings.LandscapeWarning="The game works better in landscape mode :)";Strings.OK="OK";Strings.Cancel="Cancel";Strings.Clear="Clear";Strings.Close="Close";Strings.Exit="Exit";Strings.Play="Play";Strings.Menu="Menu";Strings.Edit="Edit";Strings.Delete="Delete";Strings.NextRound="Next Round";Strings.Finish="Finish!";
Strings.of="of";Strings.Round="Round ";Strings.Total="Total: ";Strings.point="point";Strings.points="points";Strings.Install="Install!";Strings.Oops="Oops\u2026";Strings.Download="Download";Strings.About="About";Strings.PlayMusic="Play music";Strings.StopMusic="Stop music";Strings.Fullscreen="Fullscreen";Strings.START="START";Strings.RULES="RULES";Strings.CREDITS="CREDITS";Strings.Victory="Your final score was {totalPoints}<br/>\n\t<br/>\n\t{regularPoints} points for boarded aliens<br/>\n\t+<br/>\n\t{extraPoints} bonus points for ";
Strings.VictorySpeciesSingular=" single species";Strings.VictorySpeciesPlural=" different species";Strings.GameOverReposition="Repositioning aliens is not allowed!";Strings.GameOverFirstAvailable="New aliens must always be boarded in the first available position!";Strings.GameOverReplace="Replacing an already boarded alien is not allowed!";Strings.CreditsHTML='<h1 class="blue">GAME DESIGN</h2>\n\t<p>Vince Vader</p>\n\t<h1 class="green">PROGRAMMING</h2>\n\t<p>Carlos Rafael das Neves</p>\n\t<h1 class="orange">CREATIVE COORDINATION</h2>\n\t<p>Eduardo Manente</p>\n\t<h1 class="red">PLANNING COORDINATION</h2>\n\t<p>Eric de Carvalho</p>\n\t<h1 class="pink">LAYOUT AND SOUNDTRACK</h2>\n\t<p>Camila Galastri Guedes</p>\n\t<p>Jo\u00e3o Pedro Rabelo</p>\n\t<p>Marcella Lizaso de Siqueira</p>\n\t<div class="insta">\n\t<h1>INSTAGRAM</h1>\n\t<p><a target="_blank" href="https://www.instagram.com/gamelab_espm/">@gamelab_espm</a></p>\n\t<p><a target="_blank" href="https://www.instagram.com/techespm/">@techespm</a></p>\n\t<p><a target="_blank" href="https://www.instagram.com/arenas_espm/">@arenas_espm</a></p>\n\t</div>';
Strings.DecimalSeparator=".";Strings.OppositeDecimalSeparator=",";Strings.Success="Success!";Strings.Pause="Pause";Strings.Restart="Restart";Strings.Time="Time";Strings.Name="Name";
const isIOSOrSafari=function(){if(0>=navigator.userAgent.indexOf("Chrome")&&0<=navigator.userAgent.indexOf("Safari")||0<=navigator.userAgent.indexOf("Mac")&&"ontouchend"in document)return!0;switch(navigator.platform){case "iPad Simulator":case "iPhone Simulator":case "iPod Simulator":case "iPad":case "iPhone":case "iPod":return!0}return!1}(),iconMarginEm=.25,iconMarginCss="0.25em",smallMarginRem=.5,smallMarginCss="0.5rem",largeMarginRem=1,largeMarginCss="1rem",extraLargeMarginRem=1.5,extraLargeMarginCss=
"1.5rem",animationStartDelayMS=50,slowestAnimationTimeoutMS=1020,slowAnimationTimeoutMS=520,fastAnimationTimeoutMS=320,fastestAnimationTimeoutMS=120,blinkLastCounter=7,blinkSingleDurationMS=75,blinkTotalDurationMS=(blinkLastCounter+1)*blinkSingleDurationMS,baseWidth=1280,baseHeight=720,alienWidthRem=3.361930295,alienHeightRem=3.361930295,alienWidthCss=alienWidthRem+"rem",alienHeightCss=alienHeightRem+"rem",baseFontSize=32,baseHeightFontUnits=baseHeight/baseFontSize|0,iconSize=32;
class Icon{static change(a,b){a.setAttribute(Icon.DataId,b.toString());a.textContent=String.fromCharCode(b)}static create(a,b,c){const d=document.createElement("span");d.className=c?"ui-icon no-margin":"ui-icon";Icon.change(d,a);b&&b.appendChild(d);return d}static html(a,b){return`<span class="${b?"ui-icon no-margin":"ui-icon"}" ${Icon.DataId}="${a}">${String.fromCharCode(a)}</span>`}}Icon.DataId="data-icon-id";Icon.ScrollThumb=59651;Icon.Accept=59650;Icon.Clear=59649;Icon.Back=59648;Icon.Ball=257;
Icon.Goal=65793;Icon.Bomb=131329;Icon.Cucumber=196865;Icon.Edit=262401;Icon.Question=327937;Icon.DeviceH=16777473;Icon.DeviceV=16843009;Icon.Hand=16908545;Icon.Fullscreen=16974081;Icon.Restart=17039617;Icon.Open=17105153;Icon.AcceptGreen=33554689;Icon.ClearRed=33685761;Icon.Border=33882369;Icon.LineWidth0=50331905;Icon.LineWidth1=50397441;Icon.LineWidth2=50462977;Icon.LineWidth3=50528513;Icon.Eraser=67109121;Icon.Rainbow=67174657;Icon.Pause=67240193;Icon.Play=67305729;Icon.PlayGreen=83886337;
Icon.Exit=83951873;Icon.Menu=84017409;Icon.Download=84082945;Icon.Success=100663553;Icon.Error=100729089;Icon.Trophy=100794625;Icon.Clock=100860161;Icon.DeviceHI=100925697;Icon.DeviceVI=100991233;
class FullscreenControl{static requestFullscreen(a){a||(a=document.body);let b=!0,c=null;try{a.requestFullscreen?c=a.requestFullscreen():a.webkitRequestFullscreen?c=a.webkitRequestFullscreen():a.mozRequestFullScreen?c=a.mozRequestFullScreen():a.msRequestFullscreen?c=a.msRequestFullscreen():b=!1}catch(d){b=!1}b||a===document.body?ignorePromise(c):FullscreenControl.requestFullscreen()}static exitFullscreen(){let a=null;try{document.exitFullscreen?a=document.exitFullscreen():document.webkitExitFullscreen?
a=document.webkitExitFullscreen():document.mozExitFullScreen?a=document.mozExitFullScreen():document.msExitFullscreen&&(a=document.msExitFullscreen())}catch(b){}ignorePromise(a)}static get fullscreenElement(){let a=null;try{"fullscreenElement"in document&&(a=document.fullscreenElement),!a&&"webkitFullscreenElement"in document&&(a=document.webkitFullscreenElement),!a&&"mozFullscreenElement"in document&&(a=document.mozFullscreenElement),!a&&"msFullscreenElement"in document&&(a=document.msFullscreenElement)}catch(b){}return a}get onfullscreenchange(){try{if("onfullscreenchange"in
document)return document.onfullscreenchange;if("onwebkitfullscreenchange"in document)return document.onwebkitfullscreenchange;if("onmozfullscreenchange"in document)return document.onmozfullscreenchange;if("onmsfullscreenchange"in document)return document.onmsfullscreenchange}catch(a){}return null}static set onfullscreenchange(a){try{"onfullscreenchange"in document&&(document.onfullscreenchange=a),"onwebkitfullscreenchange"in document&&(document.onwebkitfullscreenchange=a),"onmozfullscreenchange"in
document&&(document.onmozfullscreenchange=a),"onmsfullscreenchange"in document&&(document.onmsfullscreenchange=a)}catch(b){}}static toggleFullscreen(){FullscreenControl.fullscreenMode=!FullscreenControl.fullscreenMode}static get fullscreenMode(){return!!FullscreenControl.fullscreenElement}static set fullscreenMode(a){a?FullscreenControl.requestFullscreen():FullscreenControl.exitFullscreen()}}
class PointerHandler{constructor(a,b=null,c=null,d=null,e=!0,f=null){this.documentTarget=document.documentElement||document.body;this.element=a;this.downCallback=b;this.moveCallback=c;this.upCallback=d;this.boundExtraTouchStart=null;"onpointerdown"in a?(this.documentDownEvent="pointerdown",this.documentMoveEvent="pointermove",this.documentUpEvent="pointerup",this.documentCancelEvent="pointercancel",this.boundDocumentDown=this.pointerDown.bind(this),this.boundDocumentUp=this.pointerUp.bind(this),this.boundDocumentMove=
this.pointerMove.bind(this),"ontouchstart"in a&&(this.boundExtraTouchStart=this.extraTouchStart.bind(this))):"ontouchstart"in a?(this.documentDownEvent="touchstart",this.documentMoveEvent="touchmove",this.documentUpEvent="touchend",this.documentCancelEvent="touchcancel",this.boundDocumentDown=this.touchStart.bind(this),this.boundDocumentUp=this.touchEnd.bind(this),this.boundDocumentMove=this.touchMove.bind(this)):(this.documentDownEvent="mousedown",this.documentMoveEvent="mousemove",this.documentUpEvent=
"mouseup",this.documentCancelEvent=null,this.boundDocumentDown=this.mouseDown.bind(this),this.boundDocumentUp=this.mouseUp.bind(this),this.boundDocumentMove=this.mouseMove.bind(this));this.lazy=e;this.outsidePointerHandler=f;this.boundExtraTouchStart&&a.addEventListener("touchstart",this.boundExtraTouchStart);a.addEventListener(this.documentDownEvent,this.boundDocumentDown);e||this.addSecondaryHandlers();this._captured=!1;this.pointerId=-1}destroy(){this.element&&(this.boundExtraTouchStart&&this.element.removeEventListener("touchstart",
this.boundExtraTouchStart),this.boundDocumentDown&&this.element.removeEventListener(this.documentDownEvent,this.boundDocumentDown));this.removeSecondaryHandlers();this.mouseUp({});zeroObject(this)}get captured(){return this._captured}addSecondaryHandlers(){this.documentTarget&&(this.documentTarget.addEventListener(this.documentMoveEvent,this.boundDocumentMove,{capture:!0,passive:!1}),this.documentTarget.addEventListener(this.documentUpEvent,this.boundDocumentUp,!0),this.documentCancelEvent&&this.documentTarget.addEventListener(this.documentCancelEvent,
this.boundDocumentUp,!0))}removeSecondaryHandlers(){this.documentTarget&&(this.boundDocumentUp&&(this.documentTarget.removeEventListener(this.documentUpEvent,this.boundDocumentUp,!0),this.documentCancelEvent&&this.documentTarget.removeEventListener(this.documentCancelEvent,this.boundDocumentUp,!0)),this.boundDocumentMove&&this.documentTarget.removeEventListener(this.documentMoveEvent,this.boundDocumentMove,!0))}extraTouchStart(a){if(a.target===this.element||this.outsidePointerHandler&&this.outsidePointerHandler(a))return cancelEvent(a)}pointerDown(a){if(0<=
this.pointerId&&"mouse"!==a.pointerType)return cancelEvent(a);const b=this.mouseDown(a);this._captured&&(this.pointerId=a.pointerId);return b}pointerMove(a){if(this._captured&&a.pointerId===this.pointerId)return this.mouseMove(a)}pointerUp(a){if(this._captured&&a.pointerId===this.pointerId)return this.pointerId=-1,this.mouseUp(a)}touchStart(a){if(!(1<a.touches.length))return 0<=this.pointerId&&this.touchEnd(a),this.pointerId=1,a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,a=this.mouseDown(a),
void 0===a&&(this.pointerId=-1),a}touchMove(a){if(this._captured&&!(1<a.touches.length))return a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,this.mouseMove(a)}touchEnd(a){if(this._captured&&!(0>this.pointerId))return this.pointerId=-1,this.mouseUp(a)}mouseDown(a){this.mouseUp(a);if(!a.button&&!View.fading&&(!a.target||a.target===this.element||this.outsidePointerHandler&&this.outsidePointerHandler(a))){if(this.downCallback&&!this.downCallback(a))return cancelEvent(a);this._captured=
!0;this.lazy&&this.addSecondaryHandlers();return cancelEvent(a)}}mouseMove(a){if(this._captured)return this.moveCallback&&this.moveCallback(a),cancelEvent(a)}mouseUp(a){if(this._captured)return this._captured=!1,this.lazy&&this.removeSecondaryHandlers(),this.upCallback&&this.upCallback(a),cancelEvent(a)}}
class Modal{constructor(a){this.options=a;this.containerElement=document.createElement("div");this.containerElement.className="base-element modal-container";this.modalElement=document.createElement("div");this.modalElement.className=a.large?"modal large":"modal";a.error&&(this.modalElement.className+=" error");"string"===typeof a.html?this.modalElement.innerHTML=a.html:this.modalElement.appendChild(a.html);this.containerElement.appendChild(this.modalElement);document.body.appendChild(this.containerElement);
this.boundDocumentKeyDown=this.documentKeyDown.bind(this);document.addEventListener("keydown",this.boundDocumentKeyDown,!0);this.fading=!0;window.setTimeout(()=>{if(a.onshowing)a.onshowing();this.resizeInternal();this.containerElement.classList.add("visible");window.setTimeout(()=>{this.fading=!1;this.containerElement.onclick=Modal.hide;View.pushHistoryStateIfNecessary();if(this.options.onshown)this.options.onshown()},slowAnimationTimeoutMS)},animationStartDelayMS)}static get visible(){return!!Modal.modal}static get currentModalElement(){return Modal.modal?
Modal.modal.modalElement:null}static show(a){if(Modal.modal)return!1;Modal.modal=new Modal(a);return!0}static hide(){Modal.modal&&Modal.modal.hideInternal()}static defaultCancelAction(){Modal.modal&&Modal.modal.hideInternal()}static windowResized(){Modal.modal&&Modal.modal.resizeInternal()}hideInternal(){Modal.modal!==this||this.fading||this.options.onhiding&&!1===this.options.onhiding()||(document.removeEventListener("keydown",this.boundDocumentKeyDown,!0),this.fading=!0,this.containerElement.classList.remove("visible"),
window.setTimeout(()=>{Modal.modal=null;View.popHistoryStateIfNecessary();if(this.options.onhidden)this.options.onhidden();document.body.removeChild(this.containerElement);zeroObject(this.options);zeroObject(this)},slowAnimationTimeoutMS))}documentKeyDown(a){"Escape"!==a.key&&27!==a.keyCode||this.hideInternal()}resizeInternal(){if(Modal.modal===this&&this.options.onresized)this.options.onresized()}}Modal.modal=null;
class Alien{constructor(a,b){if("number"===typeof a){if(a<Alien.KindMin||a>Alien.KindMax)throw Error("Invalid alien kind");this.kind=Alien.Kinds[a]}else this.kind=a;this.element=document.createElement("div");this.element.className="alien";this.element.style.width=alienWidthCss;this.element.style.height=alienHeightCss;this.element.style.backgroundImage=`url(${this.kind.imageUrl})`;this.element.style.backgroundSize=`${this.kind.cols*alienWidthRem}rem ${this.kind.rows*alienHeightRem}rem`;this.element.alien=
this;this.paused=!1;this.frame=Math.random()*this.kind.frames;this.frameInteger=this.frame|0;this._placement=void 0===b?-1:b;this.updateDOM()}static preloadAllImages(){const a=Array(Alien.Kinds.length);for(let b=Alien.Kinds.length-1;0<=b;b--)a[b]=preloadImage(Alien.Kinds[b].imageUrl);return Promise.all(a)}static create(a,b,c){a===Alien.KindRandom&&(a=Alien.KindMax-Alien.KindMin+1,a=Alien.KindMin+(Math.random()*a*a*a|0)%a);c=new Alien(a,c);Alien.aliens.push(c);b&&b.appendChild(c.element);return c}static destroyAll(){for(let a=
Alien.aliens.length-1;0<=a;a--)Alien.aliens[a].destroy(!0);Alien.aliens.splice(0)}static stepAll(a){a*=.012;const b=Alien.aliens;for(let c=b.length-1;0<=c;c--)b[c].updateDOM(a)}static fromElement(a){return a?a.alien||null:null}get placement(){return this._placement}updateDOM(a){if(!this.paused&&this.element){if(a){this.frame=(this.frame+a)%this.kind.frames;a=this.frame|0;if(this.frameInteger===a)return;this.frameInteger=a}else a=this.frameInteger;var b=this.kind.cols;this.element.style.backgroundPosition=
`-${a%b*alienWidthRem}rem -${(a/b|0)*alienHeightRem}rem`}}shrink(a){return __awaiter(this,void 0,void 0,function*(){if(this.element&&(yield delay((a||0)+animationStartDelayMS),this.element))return this.element.classList.remove("full-size"),delay(slowAnimationTimeoutMS)})}grow(a){return __awaiter(this,void 0,void 0,function*(){if(this.element&&(yield delay((a||0)+animationStartDelayMS),this.element))return this.element.classList.add("full-size"),delay(slowAnimationTimeoutMS)})}destroy(a){this.element&&
(this.element.alien=null,this.element.parentNode&&this.element.parentNode.removeChild(this.element));a||(a=Alien.aliens.indexOf(this),0<=a&&Alien.aliens.splice(a,1));zeroObject(this)}}Alien.KindRandom=-1;Alien.KindBlack=0;Alien.KindBlue=1;Alien.KindGreen=2;Alien.KindIndigo=3;Alien.KindOrange=4;Alien.KindPink=5;Alien.KindRed=6;Alien.KindYellow=7;Alien.KindMin=Alien.KindBlack;Alien.KindMax=Alien.KindYellow;Alien.KindCount=Alien.KindYellow+1;
Alien.Kinds=[{id:Alien.KindBlack,imageUrl:"assets/images/aliens/black.png",rows:4,cols:3,frames:10},{id:Alien.KindBlue,imageUrl:"assets/images/aliens/blue.png",rows:4,cols:3,frames:12},{id:Alien.KindGreen,imageUrl:"assets/images/aliens/green.png",rows:5,cols:4,frames:20},{id:Alien.KindIndigo,imageUrl:"assets/images/aliens/indigo.png",rows:5,cols:5,frames:22},{id:Alien.KindOrange,imageUrl:"assets/images/aliens/orange.png",rows:3,cols:3,frames:9},{id:Alien.KindPink,imageUrl:"assets/images/aliens/pink.png",
rows:6,cols:5,frames:29},{id:Alien.KindRed,imageUrl:"assets/images/aliens/red.png",rows:7,cols:6,frames:40},{id:Alien.KindYellow,imageUrl:"assets/images/aliens/yellow.png",rows:4,cols:4,frames:16}];Alien.aliens=[];
class View{constructor(){this.destroy=a=>__awaiter(this,void 0,void 0,function*(){this.baseElement&&(this.baseElement.parentNode&&this.attached&&this.baseElement.parentNode.removeChild(this.baseElement),this.attached&&(this.attached=!1,yield this.detach()),this.destroyInternal(a),a||zeroObject(this))});this.baseElement=document.createElement("div");this.baseElement.className="base-element";this.attached=!1}static get loading(){return View._loading}static set loading(a){View._loading!==a&&((View._loading=
a)?(View.divLoading||(View.divLoading=document.createElement("div"),View.divLoading.style.display="none",document.body.appendChild(View.divLoading)),View.divLoadingTimeout&&clearTimeout(View.divLoadingTimeout),View.divLoadingTimeout=window.setTimeout(function(){View.divLoadingTimeout=0;View.divLoading&&(View.divLoading.style.display="",View.divLoading.className="loading")},100)):View.divLoading&&(View.divLoadingTimeout&&(clearTimeout(View.divLoadingTimeout),View.divLoadingTimeout=0),document.body.removeChild(View.divLoading),
View.divLoading=null))}static get fading(){return View._fading}static createInitialView(){return View.currentView||View._loading||View._fading||View.viewStack.length?null:(new TitleView).fadeIn()}static windowResized(a){a&&View.currentView&&View.currentView.resize()}static windowHistoryStatePopped(a){View.windowHistoryStatePushed=!1;View.pushHistoryStateIfNecessary();Modal.visible&&Modal.defaultCancelAction()}static pushHistoryStateIfNecessary(){View.windowHistoryStatePushed||View.currentView&&View.currentView instanceof
TitleView&&!View._fading&&!Modal.visible||(View.windowHistoryStatePushed=!0,window.history.pushState({spaceTrain:!0},"Space Train"))}static popHistoryStateIfNecessary(){View.windowHistoryStatePushed&&window.history.back()}static createHorizontalSpacer(a,b,c){const d=c?a.querySelector("#"+c):document.createElement("div");d.className="horizontal-spacer";d.style.width=b+"rem";c||a.appendChild(d);return d}static createVerticalSpacer(a,b,c){const d=c?a.querySelector("#"+c):document.createElement("div");
d.className="vertical-spacer";d.style.height=b+"rem";c||a.appendChild(d);return d}static createButton(a,b,c,...d){const e=document.createElement("button"),f="string"===typeof b?b:"number"===typeof b?null:b.text||null;(b="string"===typeof b?0:"number"===typeof b?b:b.imageId||0)&&Icon.create(b,e,!f);e.setAttribute("type","button");c&&prepareButtonBlink(e,!1,c);a&&a.appendChild(e);f&&e.appendChild(document.createTextNode(f));if(d)for(a=0;a<d.length;a+=2)e.setAttribute(d[a],d[a+1]);return e}static createBlackButton(a,
b,c,d,...e){a=[a,b,c];e&&e.length&&a.push.apply(a,e);a.push("class");a.push("black "+(d||""));return View.createButton.apply(this,a)}static createWhiteButton(a,b,c,d,...e){a=[a,b,c];e&&e.length&&a.push.apply(a,e);a.push("class");a.push("white "+(d||""));return View.createButton.apply(this,a)}static createBlueButton(a,b,c,d,...e){a=[a,b,c];e&&e.length&&a.push.apply(a,e);a.push("class");a.push("blue "+(d||""));return View.createButton.apply(this,a)}static createGreenButton(a,b,c,d,...e){a=[a,b,c];e&&
e.length&&a.push.apply(a,e);a.push("class");a.push("green "+(d||""));return View.createButton.apply(this,a)}static createOrangeButton(a,b,c,d,...e){a=[a,b,c];e&&e.length&&a.push.apply(a,e);a.push("class");a.push("orange "+(d||""));return View.createButton.apply(this,a)}static createRedButton(a,b,c,d,...e){a=[a,b,c];e&&e.length&&a.push.apply(a,e);a.push("class");a.push("red "+(d||""));return View.createButton.apply(this,a)}static createPinkButton(a,b,c,d,...e){a=[a,b,c];e&&e.length&&a.push.apply(a,
e);a.push("class");a.push("pink "+(d||""));return View.createButton.apply(this,a)}releaseResources(){}loadResources(){}resize(){}fadeInFinished(){}finishFadeIn(a){window.setTimeout(()=>{this.resize();View.cover.classList.remove("visible");window.setTimeout(()=>{View._fading=!1;View.popHistoryStateIfNecessary();document.body.removeChild(View.cover);this.fadeInFinished();a()},slowAnimationTimeoutMS)},animationStartDelayMS)}fadeIn(){if(View._fading||View.currentView===this)return null;View._fading=!0;
View.currentView=this;return new Promise(a=>{if(this.baseElement&&!this.attached){View.main.appendChild(this.baseElement);this.attached=!0;const b=this.attach();if(b){b.then(()=>{this.finishFadeIn(a)},c=>{console.error(c)});return}}this.finishFadeIn(a)})}fadeOut(a){if(View._fading||View.currentView!==this)return null;View._fading=!0;return new Promise(b=>{document.body.appendChild(View.cover);window.setTimeout(()=>{View.cover.classList.add("visible");window.setTimeout(()=>__awaiter(this,void 0,void 0,
function*(){yield this.destroy(a);a&&View.viewStack.push(this);View.currentView=null;View._fading=!1;View.pushHistoryStateIfNecessary();b()}),slowAnimationTimeoutMS)},animationStartDelayMS)})}fadeTo(a,b=!1){return View._fading||View.currentView!==this?null:(b=this.fadeOut(b))?b.then(()=>{const c=a().fadeIn();if(c)return c}):null}fadeToPrevious(){if(View._fading||View.currentView!==this||!View.viewStack.length)return null;const a=this.fadeOut(!1);return a?a.then(()=>{const b=View.viewStack.pop().fadeIn();
if(b)return b}):null}}View.main=document.getElementById("main");View.cover=document.getElementById("cover");View._loading=!1;View._fading=!1;View.mainLandscape=!1;View.currentView=null;View.viewStack=[];View.divLoading=null;View.divLoadingTimeout=0;View.windowHistoryStatePushed=!1;
class CreditsView extends View{constructor(){super();var a=View.createWhiteButton(this.baseElement,{imageId:Icon.Clear,text:Strings.Close},this.back.bind(this),"small");a.style.position="absolute";a.style.left=extraLargeMarginCss;a.style.top=extraLargeMarginCss;a=document.createElement("div");a.className="text-center";a.style.paddingLeft=smallMarginCss;a.style.paddingRight=smallMarginCss;a.style.paddingBottom=smallMarginCss;a.innerHTML=Strings.CreditsHTML;this.baseElement.appendChild(a);this.textProtection=
document.createElement("div");this.textProtection.className="text-protection"}attach(){return __awaiter(this,void 0,void 0,function*(){document.body.insertBefore(this.textProtection,document.body.firstChild)})}detach(){return __awaiter(this,void 0,void 0,function*(){document.body.removeChild(this.textProtection)})}destroyInternal(a){}back(a){this.fadeToPrevious();return!0}}
class GameView extends View{constructor(){super();this.baseElement.classList.add("text-center");var a=View.createWhiteButton(this.baseElement,{imageId:Icon.Clear,text:Strings.Close},this.back.bind(this),"small");a.style.position="absolute";a.style.left=extraLargeMarginCss;a.style.top=extraLargeMarginCss;a=View.createBlueButton(this.baseElement,{imageId:Icon.Accept,text:Strings.NextRound},this.nextRound.bind(this),"fade small visible");a.setAttribute("disabled","disabled");a.style.position="absolute";
a.style.right=extraLargeMarginCss;a.style.top=extraLargeMarginCss;this.nextRoundButton=a;a=document.createElement("div");a.style.pointerEvents="none";a.style.marginTop=alienHeightRem+extraLargeMarginRem+"rem";a.style.height=alienHeightCss;this.shelf=a;this.baseElement.appendChild(a);a=document.createElement("div");a.className="train";this.alienRow=a;var b=Array(GameView.MaximumAlienCount);this.targets=b;this.lastHoverTarget=-1;for(var c=0;c<b.length;c++){var d=document.createElement("div");d.className=
"target";b[c]=d;a.appendChild(d)}this.baseElement.appendChild(a);a=document.createElement("div");a.className="result-label";this.resultLabel=a;b=document.createElement("span");b.className="round";a.appendChild(b);this.resultLabelRound=b;b=Array(GameView.TotalRoundCount);for(c=0;c<GameView.TotalRoundCount;c++){d=document.createElement("span");d.className="marker";a.appendChild(d);b[c]=d;const e=document.createElement("span");e.className="points";d.appendChild(e)}this.resultLabelMarker=b;b=document.createElement("span");
b.className="total";a.appendChild(b);this.resultLabelTotal=b;b=document.createElement("div");b.className="row2";b.innerHTML='<s>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</s><img src="assets/images/logo-small.png" /><s>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</s>';a.appendChild(b);this.baseElement.appendChild(a);this.musicButton=View.createWhiteButton(this.baseElement,musicPlaying?Strings.StopMusic:
Strings.PlayMusic,toggleMusic,"fade small visible");this.musicButton.style.position="absolute";this.musicButton.style.left=extraLargeMarginCss;this.musicButton.style.bottom=extraLargeMarginCss;this.baseElement.appendChild(this.musicButton);this.alive=!0;this.animating=!1;this.lastTime=this.frameRequest=0;this.movingAlien=this.pointerHandler=null;this.lastPlacedAlien=this.points=this.round=this.movingInitialY=this.movingInitialX=0;this.originalAlienPlacement=-1;this.boundMouseDown=this.mouseDown.bind(this);
this.boundMouseMove=this.mouseMove.bind(this);this.boundMouseUp=this.mouseUp.bind(this);this.boundOutsidePointerHandler=this.outsidePointerHandler.bind(this);this.boundRender=this.render.bind(this)}attach(){return __awaiter(this,void 0,void 0,function*(){musicButton=this.musicButton;updateMusicButton();this.lastTime=performance.now();this.alive=!0;this.pointerHandler=new PointerHandler(this.baseElement,this.boundMouseDown,this.boundMouseMove,this.boundMouseUp,!1,this.boundOutsidePointerHandler)})}detach(){return __awaiter(this,
void 0,void 0,function*(){musicButton=null;this.alive=!1;this.pointerHandler&&(this.pointerHandler.destroy(),this.pointerHandler=null);this.frameRequest&&(cancelAnimationFrame(this.frameRequest),this.frameRequest=0)})}destroyInternal(a){a||Alien.destroyAll()}fadeInFinished(){this.frameRequest&&(cancelAnimationFrame(this.frameRequest),this.frameRequest=0);this.frameRequest=requestAnimationFrame(this.boundRender);this.restart()}back(a){this.fadeTo(()=>new TitleView);return!0}displayAddedPoints(a,b){return __awaiter(this,
void 0,void 0,function*(){b&&1<this.round&&this.round<=GameView.TotalRoundCount&&(this.resultLabelMarker[this.round-2].firstChild.textContent=a.toString());if(a){var c=document.createElement("div");c.className="added-points";c.textContent=`+ ${a} ${1===a?Strings.point:Strings.points}!`;this.baseElement.appendChild(c);yield delay(animationStartDelayMS);this.alive&&(c.classList.add("fading"),yield delay(1500),this.alive&&this.baseElement.removeChild(c))}})}generateNewAliens(a){return __awaiter(this,
void 0,void 0,function*(){var b=GameView.MaximumAlienCount,c=this.shelf,d=c.getElementsByClassName("alien");if(d.length){b=0;const f=[];var e=[];for(let g=d.length-1,l=0;0<=g;g--,l+=75){const k=Alien.fromElement(d[g]);k&&(k.paused||(f.push(k.shrink(l)),b++),e.push(k))}this.resultLabel.classList.contains("visible")&&(this.resultLabel.classList.remove("visible"),f.push(delay(slowAnimationTimeoutMS)));yield Promise.all(f);if(!this.alive)return;for(d=e.length-1;0<=d;d--)e[d].destroy()}else if(this.resultLabel.classList.contains("visible")&&
(this.resultLabel.classList.remove("visible"),yield delay(slowAnimationTimeoutMS),!this.alive))return;this.displayAddedPoints(a,!0);e=Array(b);for(let f=b-1,g=0;0<=f;f--,g+=75)b=Alien.create(Alien.KindRandom,c),e[f]=b.grow(g);for(c=GameView.TotalRoundCount;1<=c;c--)c>this.round?this.resultLabelMarker[c-1].classList.remove("done"):this.resultLabelMarker[c-1].classList.add("done"),c>=this.round&&(this.resultLabelMarker[c-1].firstChild.textContent="");this.resultLabelRound.textContent=Strings.Round+
this.round;this.resultLabelTotal.textContent=Strings.Total+this.points;yield delay(animationStartDelayMS);this.alive&&(this.resultLabel.classList.add("visible"),yield Promise.all(e),this.alive&&(this.animating=!1))})}restart(){return __awaiter(this,void 0,void 0,function*(){if(this.alive&&!this.animating&&!this.movingAlien){this.nextRoundButton.setAttribute("disabled","disabled");this.nextRoundButton.replaceChild(document.createTextNode(Strings.NextRound),this.nextRoundButton.childNodes[1]);this.animating=
!0;var a=this.baseElement.getElementsByClassName("alien"),b=[];for(let c=a.length-1,d=0;0<=c;c--,d+=75){const e=Alien.fromElement(a[c]);e&&!e.paused&&b.push(e.shrink(d))}yield Promise.all(b);this.alive&&(Alien.destroyAll(),this.animating=!1,this.lastPlacedAlien=this.points=this.round=0,this.originalAlienPlacement=-1,this.nextRound())}})}showMessage(a,b){return __awaiter(this,void 0,void 0,function*(){if(!this.animating)return this.animating=!0,new Promise(c=>__awaiter(this,void 0,void 0,function*(){Modal.show({html:b,
error:a,onhidden:()=>{this.alive&&(this.animating=!1,c())}})}))})}gameOver(a){return __awaiter(this,void 0,void 0,function*(){yield this.showMessage(!0,a);if(this.alive&&(this.animating=!0,yield delay(slowAnimationTimeoutMS),this.alive))return this.animating=!1,this.restart()})}gameFinished(a,b,c){return __awaiter(this,void 0,void 0,function*(){this.animating=!0;this.resultLabel.classList.remove("visible");yield delay(fastAnimationTimeoutMS);this.alive&&(this.round++,yield this.displayAddedPoints(a,
!1),this.alive&&(this.animating=!1,yield this.showMessage(!1,Strings.Victory.replace("{totalPoints}",this.points.toString()).replace("{regularPoints}",(this.points-c).toString()).replace("{extraPoints}",c.toString())+b+(1===b?Strings.VictorySpeciesSingular:Strings.VictorySpeciesPlural)),this.alive&&this.restart()))})}computeAddedPoints(){if(!this.alienRow)return 0;const a=this.alienRow.getElementsByClassName("alien");let b=Alien.KindRandom,c=0,d=0;for(let f=a.length-1;0<=f;f--){var e=Alien.fromElement(a[f]);
e&&(e=e.kind.id,b===e?c++:(d+=GameView.PointsPerSequence[c],c=1,b=e))}return d+GameView.PointsPerSequence[c]}computeExtraPoints(){if(!this.alienRow)return{typeCount:0,extraPoints:0};const a=this.alienRow.getElementsByClassName("alien"),b=Array(Alien.KindCount);b.fill(0);let c=0;for(let d=a.length-1;0<=d;d--){const e=Alien.fromElement(a[d]);e&&!b[e.kind.id]++&&c++}return{typeCount:c,extraPoints:3*c}}nextRound(){if(!this.alive||this.animating||this.movingAlien)return!1;let a=0;this.lastPlacedAlien&&
(a=this.computeAddedPoints(),this.points+=a);if(this.lastPlacedAlien>=GameView.MaximumAlienCount){const {typeCount:b,extraPoints:c}=this.computeExtraPoints();a+=c;this.points+=c;this.gameFinished(a,b,c);return!0}this.animating=!0;this.round++;this.nextRoundButton.setAttribute("disabled","disabled");this.generateNewAliens(a);return!0}getTarget(a,b){let c=this.alienRow.getBoundingClientRect();if(b>=c.top&&b<c.bottom){b=this.targets;for(let d=b.length-1;0<=d;d--)if(!(a<(c=b[d].getBoundingClientRect()).left||
a>=c.right))return d}return-1}mouseDown(a){if(!this.alive||this.animating)return!1;const b=a.clientX;a=a.clientY;const c=[this.shelf,this.alienRow];for(let e=c.length-1;0<=e;e--){const f=c[e].getElementsByClassName("alien");var d=c[e].getBoundingClientRect();if(a>=d.top&&a<d.bottom&&f&&f.length)for(let g=f.length-1;0<=g;g--)if(d=f[g].getBoundingClientRect(),b>=d.left&&b<d.right&&(d=Alien.fromElement(f[g]))&&d.element&&!d.paused)return d.element.classList.add("moving"),this.movingInitialX=b,this.movingInitialY=
a,this.movingAlien=d,this.originalAlienPlacement=d.placement,0<=this.lastHoverTarget&&(this.targets[this.lastHoverTarget].classList.remove("hover"),this.lastHoverTarget=-1),1===e&&(this.lastHoverTarget=this.getTarget(b,a),0<=this.lastHoverTarget&&this.targets[this.lastHoverTarget].classList.add("hover")),!0}return!1}mouseMove(a){var b=this.movingAlien;if(b&&b.element){var c=a.clientX;a=a.clientY;b.element.style.transform=`translate(${c-this.movingInitialX}px, ${a-this.movingInitialY}px)`;b=this.getTarget(c,
a);b!==this.lastHoverTarget&&(c=this.targets,0<=this.lastHoverTarget&&c[this.lastHoverTarget].classList.remove("hover"),0<=b&&c[b].classList.add("hover"),this.lastHoverTarget=b)}}mouseUp(a){const b=this.targets;0<=this.lastHoverTarget&&(b[this.lastHoverTarget].classList.remove("hover"),this.lastHoverTarget=-1);const c=this.movingAlien;c&&c.element&&(this.movingAlien=null,a=this.getTarget(a.clientX,a.clientY),c.element.classList.remove("moving"),c.element.style.transform="",0>a||(0<=this.originalAlienPlacement?
this.originalAlienPlacement!==a&&this.gameOver(Strings.GameOverReposition):b[a].childNodes.length?this.gameOver(Strings.GameOverReplace):this.lastPlacedAlien!==a?this.gameOver(Strings.GameOverFirstAvailable):(c.paused=!0,c.element.style.visibility="hidden",Alien.create(c.kind,b[a],this.lastPlacedAlien).grow(),this.lastPlacedAlien++,this.round<GameView.TotalRoundCount&&this.nextRoundButton.removeAttribute("disabled"),this.lastPlacedAlien>=GameView.MaximumAlienCount&&(this.nextRoundButton.removeAttribute("disabled"),
this.nextRoundButton.replaceChild(document.createTextNode(Strings.Finish),this.nextRoundButton.childNodes[1])))))}outsidePointerHandler(a){return a.target&&"target"===a.target.className&&a.target.childNodes.length?!0:!1}render(a){if(this.alive){this.frameRequest=requestAnimationFrame(this.boundRender);var b=a-this.lastTime;this.lastTime=a;33<b&&(b=33);Alien.stepAll(b)}else this.frameRequest=0}}GameView.TotalRoundCount=5;GameView.MaximumAlienCount=8;
GameView.PointsPerSequence=[0,1,3,6,10,15,21,28,36];
class RulesView extends View{constructor(){super();this.baseElement.classList.add("text-center");var a=View.createWhiteButton(this.baseElement,{imageId:Icon.Clear,text:Strings.Close},this.back.bind(this),"small");a.style.position="absolute";a.style.left=extraLargeMarginCss;a.style.top=extraLargeMarginCss;this.fadingRule=!1;this.currentRule=0;var b=document.createElement("div");b.className="rule-container";a=document.createElement("div");a.className="rule-prev fade";a.onclick=this.previousRule.bind(this);
this.previousRuleButton=a;b.appendChild(a);a=document.createElement("div");a.className="rule-image";a.style.background="none";this.ruleImageContainer=a;b.appendChild(a);var c=document.createElement("div");c.className="rule-next fade visible";c.onclick=this.nextRule.bind(this);this.nextRuleButton=c;b.appendChild(c);this.baseElement.appendChild(b);b=Array(RulesView.TotalRuleCount);for(c=0;c<RulesView.TotalRuleCount;c++){const d=document.createElement("img");d.className=c?"rule-image fade":"rule-image fade visible";
d.src=`assets/images/rule${c}.png`;b[c]=d}this.ruleImage=b;a.appendChild(b[0])}attach(){return __awaiter(this,void 0,void 0,function*(){})}detach(){return __awaiter(this,void 0,void 0,function*(){})}destroyInternal(a){}back(a){this.fadeToPrevious();return!0}changeRule(a){return __awaiter(this,void 0,void 0,function*(){if(!View.fading&&!this.fadingRule&&this.ruleImage){var b=this.currentRule+a;0>b||b>=RulesView.TotalRuleCount||(this.fadingRule=!0,0<b?this.previousRuleButton.classList.add("visible"):
this.previousRuleButton.classList.remove("visible"),b<RulesView.TotalRuleCount-1?this.nextRuleButton.classList.add("visible"):this.nextRuleButton.classList.remove("visible"),this.ruleImage[this.currentRule].classList.remove("visible"),yield delay(slowAnimationTimeoutMS),this.ruleImageContainer.removeChild(this.ruleImage[this.currentRule]),this.ruleImageContainer.appendChild(this.ruleImage[b]),yield delay(animationStartDelayMS),this.ruleImage[b].classList.add("visible"),this.currentRule=b,yield delay(slowAnimationTimeoutMS),
this.fadingRule=!1)}})}previousRule(){this.changeRule(-1)}nextRule(){this.changeRule(1)}}RulesView.TotalRuleCount=5;
class TitleView extends View{constructor(){super();this.baseElement.innerHTML='\n\t\t<div style="margin: 2em 0;">\n\t\t\t<img id="logo" src="assets/images/logo.png" alt="Logo" class="fade" style="width: 20rem;" />\n\t\t</div>\n\t\t<div id="subtitle" class="fade" style="margin: 2em 0 1em;">\n\t\t\t<s>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</s>\n\t\t\t&nbsp;\n\t\t\tBLOCKCHAIN GAME\n\t\t\t&nbsp;\n\t\t\t<s>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</s>\n\t\t</div>\n\t\t';this.baseElement.className=
"text-center";this.logo=this.baseElement.querySelector("#logo");this.subtitle=this.baseElement.querySelector("#subtitle");this.startButton=View.createBlueButton(this.baseElement,Strings.START,this.start.bind(this),"fade","data-teste","1");this.startButton.style.marginBottom=largeMarginCss;this.baseElement.appendChild(document.createElement("br"));this.rulesButton=View.createOrangeButton(this.baseElement,Strings.RULES,this.rules.bind(this),"fade");this.rulesButton.style.marginBottom=largeMarginCss;
this.baseElement.appendChild(document.createElement("br"));this.creditsButton=View.createPinkButton(this.baseElement,Strings.CREDITS,this.credits.bind(this),"fade");this.creditsButton.style.marginBottom=largeMarginCss;this.musicButton=View.createWhiteButton(this.baseElement,musicPlaying?Strings.StopMusic:Strings.PlayMusic,toggleMusic,"fade small");this.musicButton.style.position="absolute";this.musicButton.style.left=extraLargeMarginCss;this.musicButton.style.bottom=extraLargeMarginCss;this.installButton=
View.createBlueButton(this.baseElement,Strings.Install,this.install.bind(this),"fade small");this.installButton.style.position="absolute";this.installButton.style.right=extraLargeMarginCss;this.installButton.style.bottom=extraLargeMarginRem+2+"rem";this.fullscreenButton=View.createWhiteButton(this.baseElement,Strings.Fullscreen,this.fullscreen.bind(this),"fade small");this.fullscreenButton.style.position="absolute";this.fullscreenButton.style.right=extraLargeMarginCss;this.fullscreenButton.style.bottom=
extraLargeMarginCss;this.fadeSequence=0;this.fadeElements=null;this.fadeInterval=0;this.boundInstallationPromptHandler=this.installationPromptHandler.bind(this);this.installationPromptHandler()}attach(){return __awaiter(this,void 0,void 0,function*(){installationPromptHandler=this.boundInstallationPromptHandler;musicButton=this.musicButton;updateMusicButton()})}detach(){return __awaiter(this,void 0,void 0,function*(){musicButton=installationPromptHandler=null;this.fadeInterval&&(clearInterval(this.fadeInterval),
this.fadeInterval=0)})}destroyInternal(a){}fadeInFinished(){this.startFadeSequence(1)}startFadeSequence(a,b){if(!this.fadeSequence){var c=[this.logo,this.subtitle,this.startButton,this.rulesButton,this.creditsButton,this.musicButton,this.installButton,this.fullscreenButton];0>a&&c.reverse();this.fadeSequence=a;this.fadeElements=c;this.fadeInterval=window.setInterval(()=>{var d=Math.abs(this.fadeSequence)-1;!this.fadeElements||d>=this.fadeElements.length?(clearInterval(this.fadeInterval),this.fadeSequence=
0,this.fadeElements=null,this.fadeInterval=0,b&&b()):(d=this.fadeElements[d],0<this.fadeSequence?(d.classList.add("visible"),this.fadeSequence++):(d.classList.remove("visible"),this.fadeSequence--))},100)}}start(a){if(Modal.visible||this.fadeSequence)return!1;this.startFadeSequence(-1,()=>this.fadeTo(()=>new GameView));return!0}rules(a){if(this.fadeSequence)return!1;this.startFadeSequence(-1,()=>this.fadeTo(()=>new RulesView,!0));return!0}credits(a){if(this.fadeSequence)return!1;this.startFadeSequence(-1,
()=>this.fadeTo(()=>new CreditsView,!0));return!0}fullscreen(a){FullscreenControl.toggleFullscreen();return!0}install(a){if(installationPrompt&&installationPrompt.prompt){try{a=installationPrompt,installationPrompt=null,a.prompt()}catch(b){}setTimeout(this.boundInstallationPromptHandler,blinkTotalDurationMS)}return!0}installationPromptHandler(){this.installButton&&(this.installButton.style.display=installationPrompt?"":"none")}}
let scaleFactor=-1,widthCss=0,heightCss=0,baseLeftCss=0,baseTopCss=0,fontSize=0,fontSizeCss="0px",musicPlaying=!1,audioContext=null,audioBuffer=null,audioBufferSource=null,bgMusic=null,musicButton=null,installationPrompt=null,installationPromptHandler=null,landscapeWarning=null;function ignorePromise(a){try{const b=()=>{};a&&a.then&&a.then(b,b)}catch(b){}}
function cancelEvent(a){a&&("isCancelled"in a&&(a.isCancelled=!0),"preventDefault"in a&&a.preventDefault(),"stopPropagation"in a&&a.stopPropagation());return!1}function format2(a){return 10>a?"0"+a:a.toString()}function rem2Px(a){return fontSize*a+"px"}function rem2PxNumber(a){return fontSize*a}function smoothStep(a){return a*a*(3-2*a)}function delay(a){return new Promise(b=>window.setTimeout(b,a))}
function handleBlink(a){const b=a[0],c=a[1];0<b&&b<blinkLastCounter?(c.style.visibility=b&1?"":"hidden",a[0]=b+1):abortBlink(c)}function abortBlink(a){if(a){var b=a.getAttribute("data-blink-interval");b&&(a.setAttribute("data-blink-interval",""),(b=parseInt(b))&&clearInterval(b),a.style.visibility="")}}function blink(a){a&&(abortBlink(a),a.style.visibility="hidden",a.setAttribute("data-blink-interval",window.setInterval(handleBlink,blinkSingleDurationMS,[1,a]).toString()))}
function prepareButtonBlink(a,b,c){a.onclick=d=>{View.loading||View.fading||!b&&Modal.visible||!c(d)||blink(a)}}function zeroObject(a){for(let b in a)switch(typeof a[b]){case "function":break;case "boolean":a[b]=!1;break;case "number":a[b]=0;break;default:const c=a[b];Array.isArray(c)&&c.fill(null);a[b]=null}}
function adjustWindowSize(){widthCss=window.innerWidth;heightCss=window.innerHeight;document.documentElement&&"clientWidth"in document.documentElement&&(widthCss=document.documentElement.clientWidth,heightCss=document.documentElement.clientHeight);if(isIOSOrSafari){var a=null;document.documentElement&&"getBoundingClientRect"in document.documentElement?a=document.documentElement.getBoundingClientRect():"getBoundingClientRect"in document.body&&(a=document.body.getBoundingClientRect());a&&(widthCss=
a.right-a.left,heightCss=a.bottom-a.top)}a=`scale(${Math.ceil(.35*widthCss)},${Math.ceil(.35*heightCss)})`;var b=View.cover.style;b.oTransform=a;b.msTransform=a;b.mozTransform=a;b.webkitTransform=a;b.transform=a;a=scaleFactor;let c;widthCss/heightCss>=baseWidth/baseHeight?(c=heightCss,scaleFactor=heightCss/baseHeight,b=widthCss):(b=widthCss,scaleFactor=widthCss/baseWidth,c=baseHeight*scaleFactor);baseLeftCss=.5*(widthCss-b)|0;0>baseLeftCss&&(baseLeftCss=0);baseTopCss=.5*(heightCss-c)|0;0>baseTopCss&&
(baseTopCss=0);View.main.style.left=baseLeftCss+"px";View.main.style.top=baseTopCss+"px";widthCss<=heightCss?landscapeWarning||(landscapeWarning=document.createElement("div"),landscapeWarning.style.pointerEvents="none",landscapeWarning.style.textAlign="center",landscapeWarning.style.position="absolute",landscapeWarning.style.left="0",landscapeWarning.style.top=smallMarginCss,landscapeWarning.style.width="100%",landscapeWarning.style.zIndex="9999",landscapeWarning.textContent=Strings.LandscapeWarning,
document.body.appendChild(landscapeWarning)):landscapeWarning&&(document.body.removeChild(landscapeWarning),landscapeWarning=null);View.main.style.width=b+"px";View.main.style.height=c+"px";scaleFactor!==a?(fontSize=c/baseHeightFontUnits|0,fontSizeCss=fontSize+"px",document.documentElement&&(document.documentElement.style.fontSize=fontSizeCss),document.body.style.fontSize=fontSizeCss,View.windowResized(!0)):View.windowResized(!1);Modal.windowResized()}
function beforeInstallPrompt(a){"preventDefault"in a&&a.preventDefault();installationPrompt=a;installationPromptHandler&&installationPromptHandler()}
function toggleMusic(a){if(bgMusic)musicPlaying===bgMusic.paused&&(musicPlaying=!musicPlaying),musicPlaying?(musicPlaying=!1,bgMusic.pause()):(musicPlaying=!0,bgMusic.play());else if(audioContext&&audioBuffer)try{audioBufferSource&&(audioBufferSource.stop(),audioBufferSource.disconnect(),audioBufferSource=null),musicPlaying?(audioContext.suspend(),musicPlaying=!1):(audioContext.resume(),audioBufferSource=audioContext.createBufferSource(),audioBufferSource.buffer=audioBuffer,audioBufferSource.loop=
!0,audioBufferSource.connect(audioContext.destination),audioBufferSource.start(),musicPlaying=!0)}catch(b){}a.target&&a.target.tagName&&(a.target.textContent=musicPlaying?Strings.StopMusic:Strings.PlayMusic);return!0}function updateMusicButton(){musicButton&&(musicButton.textContent=musicPlaying?Strings.StopMusic:Strings.PlayMusic)}let fullscreenChangedTimeout=0;
function fullscreenChanged(a){fullscreenChangedTimeout&&(clearTimeout(fullscreenChangedTimeout),fullscreenChangedTimeout=0);try{FullscreenControl.fullscreenMode?fullscreenChangedTimeout=setTimeout(fullscreenChangedHandler,150):fullscreenChangedHandler()}catch(b){}}
function fullscreenChangedHandler(){fullscreenChangedTimeout=0;if(screen.mozLockOrientation&&screen.mozUnlockOrientation)try{if(FullscreenControl.fullscreenMode){if(screen.mozLockOrientation("landscape-primary"))return}else if(screen.mozUnlockOrientation())return}catch(a){}if(screen.msLockOrientation&&screen.msUnlockOrientation)try{if(FullscreenControl.fullscreenMode){if(screen.msLockOrientation("landscape-primary"))return}else if(screen.msUnlockOrientation())return}catch(a){}if(screen.orientation&&
screen.orientation.lock&&screen.orientation.unlock)try{ignorePromise(FullscreenControl.fullscreenMode?screen.orientation.lock("landscape-primary"):screen.orientation.unlock())}catch(a){}}function preloadImage(a){return new Promise(b=>{const c=document.createElement("img");c.onload=()=>{c.style.display="none";c.style.position="absolute";c.style.width="0";c.style.height="0";c.style.zIndex="-1";b()};c.onerror=()=>b();c.setAttribute("src",a)})}
function setup(){function a(){View.loading=!1;bgMusic&&(bgMusic.onplay=function(){musicPlaying=!0;updateMusicButton()},bgMusic.onpause=function(){musicPlaying=!1;updateMusicButton()});View.createInitialView()}Strings.init();View.loading=!0;"serviceWorker"in navigator&&(window.addEventListener("beforeinstallprompt",beforeInstallPrompt),navigator.serviceWorker.register("sw.js"));window.onpopstate=View.windowHistoryStatePopped;window.onresize=adjustWindowSize;adjustWindowSize();FullscreenControl.onfullscreenchange=
fullscreenChanged;Promise.all([function(){return __awaiter(this,void 0,void 0,function*(){bgMusic=document.createElement("audio");bgMusic.loop=!0;bgMusic.src="assets/sounds/bgfade.mp3";document.body.appendChild(bgMusic);bgMusic.load()})}(),Alien.preloadAllImages()]).then(a,a)}window.spacetrainStepMAIN=!0;window.spacetrainCheckSetup&&window.spacetrainCheckSetup();
